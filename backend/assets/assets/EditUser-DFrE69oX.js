import{_ as Q,z as G,B as re,k as V,o as i,C as W,g as ne,c as u,a as t,b as p,D as le,n as P,v as b,t as g,d as c,w as X,T as oe,q as y,p as U,u as ie,r as C,l as de,f as ue,y as me,E as R,F as pe,m as ce,A as fe,e as H,s as ye}from"./index-oTY3-4pI.js";import{B as be}from"./BackButton-DwWNFNS9.js";const ve={class:"modal-container"},ge={class:"form-group"},he={key:0,class:"payment-fields"},we={key:0,class:"error"},xe={key:0,class:"error"},ke={key:0,class:"error"},Ne={key:1,class:"payment-fields"},Ce={key:0,class:"error"},Be={key:2,class:"payment-fields"},De={key:0,class:"error"},Ae={class:"modal-actions"},Oe=["disabled"],Pe={__name:"PaymentModal",props:{show:{type:Boolean,default:!1},payment:{type:Object,required:!0,default:()=>({})},userId:{type:Number,required:!0}},emits:["close","save"],setup(F,{emit:Z}){const k=Z,M=F,l=G({}),r=G({creditCardNumber:"",expiryDate:"",cvc:"",iban:"",paypalEmail:""});re(()=>M.payment,d=>{Object.assign(l,d||{})},{immediate:!0});const w=V(()=>{if(!l.paymentOption)return!0;switch(l.paymentOption){case"credit card":return!l.creditCardNumber||!l.expiryDate||!l.cvc||!!r.creditCardNumber||!!r.expiryDate||!!r.cvc;case"bank transfer":return!l.iban||!!r.iban;case"paypal":return!l.paypalEmail||!!r.paypalEmail;default:return!0}}),x=V({get(){return l.expiryDate?B(l.expiryDate):""},set(d){l.expiryDate=d}});function B(d){if(!d)return"";const s=new Date(d);if(isNaN(s.getTime()))return console.warn("Ungültiges Datum:",d),"";const m=s.getFullYear(),v=String(s.getMonth()+1).padStart(2,"0"),O=String(s.getDate()).padStart(2,"0");return`${m}-${v}-${O}`}function D(){const d=(l.creditCardNumber||"").replace(/\s+/g,"");if(!d){r.creditCardNumber="";return}/^\d{13,19}$/.test(d)?r.creditCardNumber="":r.creditCardNumber="Bitte eine gültige Kreditkartennummer (13–19 Ziffern) eingeben"}function A(){const d=l.expiryDate;if(!d){r.expiryDate="";return}const s=new Date(d);if(isNaN(s.valueOf())){r.expiryDate="Ungültiges Datum";return}s<new Date?r.expiryDate="Das Ablaufdatum darf nicht in der Vergangenheit liegen":r.expiryDate=""}function S(){const d=l.cvc;if(!d){r.cvc="";return}/^\d{3,4}$/.test(d)?r.cvc="":r.cvc="Bitte einen gültigen CVC (3–4 Ziffern) eingeben"}function a(){const d=l.iban;if(!d){r.iban="";return}/^[A-Za-z0-9]{15,34}$/.test(d)?r.iban="":r.iban="Bitte eine gültige IBAN (15–34 alphanumerische Zeichen) eingeben"}function I(){const d=l.paypalEmail;if(!d){r.paypalEmail="";return}/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)?r.paypalEmail="":r.paypalEmail="Bitte eine gültige E-Mail-Adresse eingeben"}function E(){k("close")}async function T(){var d,s;try{if(r.creditCardNumber||r.expiryDate||r.cvc||r.iban||r.paypalEmail)return y.fire({title:"Bitte alle Fehler beheben",icon:"warning",confirmButtonText:"OK"});const m={...l};m.user=M.userId;let v;l.id?v=await K(l.id,m):v=await z(m),k("save",v.data),k("close"),N(),l.id?await y.fire({title:"Zahlungsmethode aktualisiert!",text:"Zahlungsmethode wurde erfolgreich aktualisiert.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0}):await y.fire({title:"Zahlungsmethode erstellt!",text:"Zahlungsmethode wurde erfolgreich erstellt.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0})}catch(m){console.error("Fehler beim Speichern der Zahlungsmethode:",m),await y.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((s=(d=m.response)==null?void 0:d.data)==null?void 0:s.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}function N(){Object.assign(l,{paymentOption:"",creditCardNumber:"",expiryDate:"",cvc:"",iban:"",paypalEmail:""}),Object.assign(r,{creditCardNumber:"",expiryDate:"",cvc:"",iban:"",paypalEmail:""})}async function z(d){var s,m;try{return await U.post("/api/payment/create",d)}catch(v){console.error("Fehler beim Erstellen der Zahlung:",v),await y.fire({title:"Fehler beim Erstellen der Zahlung!",text:((m=(s=v.response)==null?void 0:s.data)==null?void 0:m.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}async function K(d,s){var m,v;try{return await U.patch(`/api/payment/${d}`,s)}catch(O){console.error("Fehler beim Aktualisieren der Zahlung:",O),await y.fire({title:"Fehler beim Aktualisieren der Zahlung!",text:((v=(m=O.response)==null?void 0:m.data)==null?void 0:v.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}return(d,s)=>(i(),W(oe,{name:"fade-modal"},{default:ne(()=>[F.show?(i(),u("div",{key:0,class:"modal-backdrop",onClick:X(E,["self"])},[t("div",ve,[s[13]||(s[13]=t("h2",null,"Zahlungsmethode festlegen/bearbeiten",-1)),t("div",ge,[s[7]||(s[7]=t("label",{for:"paymentOption"},"Zahlungsoption",-1)),p(t("select",{id:"paymentOption","onUpdate:modelValue":s[0]||(s[0]=m=>l.paymentOption=m),class:"form-control"},s[6]||(s[6]=[t("option",{value:"credit card"},"Kreditkarte",-1),t("option",{value:"bank transfer"},"Banküberweisung",-1),t("option",{value:"paypal"},"PayPal",-1)]),512),[[le,l.paymentOption]])]),l.paymentOption==="credit card"?(i(),u("div",he,[t("div",{class:P(["form-group",{"has-error":r.creditCardNumber}])},[s[8]||(s[8]=t("label",{for:"creditCardNumber"},"Kartennummer",-1)),p(t("input",{id:"creditCardNumber",type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=m=>l.creditCardNumber=m),placeholder:"z.B. 1234567890123456",onInput:D},null,544),[[b,l.creditCardNumber]]),r.creditCardNumber?(i(),u("span",we,g(r.creditCardNumber),1)):c("",!0)],2),t("div",{class:P(["form-group",{"has-error":r.expiryDate}])},[s[9]||(s[9]=t("label",{for:"expiryDate"},"Ablaufdatum",-1)),p(t("input",{id:"expiryDate",type:"date",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=m=>x.value=m),placeholder:"YYYY-MM-DD",onBlur:A},null,544),[[b,x.value]]),r.expiryDate?(i(),u("span",xe,g(r.expiryDate),1)):c("",!0)],2),t("div",{class:P(["form-group",{"has-error":r.cvc}])},[s[10]||(s[10]=t("label",{for:"cvc"},"CVC",-1)),p(t("input",{id:"cvc",type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=m=>l.cvc=m),placeholder:"z.B. 123",onInput:S},null,544),[[b,l.cvc]]),r.cvc?(i(),u("span",ke,g(r.cvc),1)):c("",!0)],2)])):l.paymentOption==="bank transfer"?(i(),u("div",Ne,[t("div",{class:P(["form-group",{"has-error":r.iban}])},[s[11]||(s[11]=t("label",{for:"iban"},"IBAN",-1)),p(t("input",{id:"iban",type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=m=>l.iban=m),placeholder:"z.B. DE89370400440532013000",onInput:a},null,544),[[b,l.iban]]),r.iban?(i(),u("span",Ce,g(r.iban),1)):c("",!0)],2)])):l.paymentOption==="paypal"?(i(),u("div",Be,[t("div",{class:P(["form-group",{"has-error":r.paypalEmail}])},[s[12]||(s[12]=t("label",{for:"paypalEmail"},"PayPal E-Mail",-1)),p(t("input",{id:"paypalEmail",type:"email",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=m=>l.paypalEmail=m),placeholder:"z.B. user@mail.com",onInput:I},null,544),[[b,l.paypalEmail]]),r.paypalEmail?(i(),u("span",De,g(r.paypalEmail),1)):c("",!0)],2)])):c("",!0),t("div",Ae,[t("button",{class:"btn btn-primary",style:{"background-color":"#4a5043"},onClick:T,disabled:w.value}," Übernehmen ",8,Oe),t("button",{class:"btn btn-secondary",onClick:E},"Abbrechen")])])])):c("",!0)]),_:1}))}},Ee=Q(Pe,[["__scopeId","data-v-b8abed95"]]),$e={class:"edit-user"},Ue={key:0,class:"text-center"},Se={key:1},Ve={key:0,class:"form-group"},Me={id:"userId",class:"form-control static-field"},Fe={key:1,class:"form-group"},Ze={key:2,class:"form-group"},Ie={key:3,class:"form-group"},Te={key:4,class:"form-group toggle-switch"},ze={class:"switch","aria-labelledby":"isAdmin"},Ke={class:"form-group password-fields"},qe={class:"password-input-group"},Je=["type"],Le={class:"password-input-group"},Ye=["type"],je={key:0,class:"error-text"},Ge={key:5,class:"form-group address-fields"},Re={class:"form-group"},He={key:0},Qe={class:"payment-info"},We={class:"payment-icon"},Xe={key:0,class:"bi bi-bank"},_e={key:1,class:"bi bi-credit-card"},et={key:2,class:"bi bi-paypal"},tt={class:"payment-details"},at={key:0},st={key:1},rt={key:2},nt={class:"payment-actions"},lt=["onClick"],ot=["onClick"],it={key:1},dt={class:"button-group"},ut=["disabled"],mt={key:2,class:"text-center"},pt={__name:"EditUser",setup(F){const Z=ie(),k=V(()=>Z.user),M=fe(),l=ye(),r=C(!0),w=C(""),x=C(""),B=C(!1),D=C(!1),A=C(null),S=C(null),a=C({id:null,emailAddress:"",firstName:"",lastName:"",isAdmin:!1,address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payments:[]}),I=V(()=>{const o=JSON.stringify(a.value.address)!==JSON.stringify(S.value.address),e=JSON.stringify(a.value)!==JSON.stringify(S.value),f=w.value!==""&&x.value!==""&&w.value===x.value;return(e||o||f)&&!E.value}),E=V(()=>w.value&&x.value&&w.value!==x.value),T=o=>{if(!o)return"";const e=new Date(o);if(isNaN(e.getTime()))return console.warn("Ungültiges Datum:",o),"";const f=e.getFullYear(),h=String(e.getMonth()+1).padStart(2,"0"),$=String(e.getDate()).padStart(2,"0");return`${f}-${h}-${$}`},N=o=>{B.value=o};de(async()=>{const o=M.params.id||k.value.id;await z(o)});const z=async o=>{r.value=!0;try{const{data:e}=await U.get(`/api/user/${o}`);a.value={...a.value,...e,address:{...a.value.address,...e.address},payments:e.payments||[]},S.value=JSON.parse(JSON.stringify(a.value))}catch(e){console.error("Fehler beim Laden des Benutzers:",e),await y.fire({title:"Benutzer konnte nicht geladen werden.",icon:"error",confirmButtonText:"OK"})}finally{r.value=!1}},K=async o=>{if((await y.fire({title:"User löschen?",text:"Möchten Sie diesen User wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await U.delete(`/api/user/${o}`),await y.fire({title:"Gelöscht",text:"Der User wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}),await l.push({name:"AdminDashboard"})}catch(f){console.error("Fehler beim Löschen des Users:",f),await y.fire({title:"Fehler beim Löschen des Users.",icon:"error",confirmButtonText:"OK"})}},d=async()=>{if(E.value){await y.fire({title:"Passwörter stimmen nicht überein.",icon:"error",confirmButtonText:"OK"});return}const o={emailAddress:a.value.emailAddress,firstName:a.value.firstName,lastName:a.value.lastName,isAdmin:a.value.isAdmin,address:a.value.address,password:w.value||void 0};try{await U.patch(`/api/user/${a.value.id}`,o),await y.fire({title:"Benutzerdaten erfolgreich aktualisiert!",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),l.go()}catch(e){console.error("Fehler beim Speichern des Benutzers:",e),await y.fire({title:"Fehler beim Speichern der Benutzerdaten.",icon:"error",confirmButtonText:"OK"})}},s=o=>{A.value={...o},D.value=!0},m=async o=>{(await y.fire({title:"Zahlungsmethode löschen?",text:"Möchten Sie diese Zahlungsmethode wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed&&(await U.delete(`/api/payment/${o}`),a.value.payments=a.value.payments.filter(f=>f.id!==o),await y.fire({title:"Gelöscht",text:"Die Zahlungsmethode wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}))},v=()=>{A.value={paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""},D.value=!0},O=()=>{D.value=!1},_=async o=>{var e,f;try{if(A.value.id){const h=a.value.payments.findIndex($=>$.id===A.value.id);h!==-1&&(a.value.payments[h]=o)}else a.value.payments.push(o);O()}catch(h){console.error("Fehler beim Speichern der Zahlungsmethode:",h),await y.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((f=(e=h.response)==null?void 0:e.data)==null?void 0:f.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},ee=o=>o?"**** **** **** "+o.slice(-4):"n/a",te=o=>{if(!o)return"n/a";const e=o.replace(/\s/g,"");return e.length<=6?e:e.slice(0,4)+" **** **** "+e.slice(-2)},ae=o=>{if(!o)return"n/a";const[e,f]=o.split("@");return f?e[0]+"****@"+f:o};return(o,e)=>{var f,h,$,q,J,L,Y,j;return i(),u("div",$e,[ue(be),e[42]||(e[42]=t("h2",{class:"page-title form-label"},"Benutzer bearbeiten",-1)),r.value||!a.value?(i(),u("div",Ue,e[19]||(e[19]=[t("p",null,"Lade Benutzer...",-1)]))):k.value?(i(),u("div",Se,[t("form",{onSubmit:X(d,["prevent"]),class:"form-container",autocomplete:"off"},[(f=a.value)!=null&&f.id?(i(),u("div",Ve,[e[20]||(e[20]=t("label",{for:"userId",class:"form-label"},"User ID",-1)),t("div",Me,g(a.value.id),1)])):c("",!0),(h=a.value)!=null&&h.emailAddress?(i(),u("div",Fe,[e[21]||(e[21]=t("label",{for:"email",class:"form-label"},"E-Mail-Adresse*",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.emailAddress=n),type:"email",id:"email",class:"form-control",maxlength:"100",required:""},null,512),[[b,a.value.emailAddress]])])):c("",!0),($=a.value)!=null&&$.firstName?(i(),u("div",Ze,[e[22]||(e[22]=t("label",{for:"firstName",class:"form-label"},"Vorname*",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.firstName=n),type:"text",id:"firstName",class:"form-control",maxlength:"50",required:""},null,512),[[b,a.value.firstName]])])):c("",!0),(q=a.value)!=null&&q.lastName?(i(),u("div",Ie,[e[23]||(e[23]=t("label",{for:"lastName",class:"form-label"},"Nachname*",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.lastName=n),type:"text",id:"lastName",class:"form-control",maxlength:"50",required:""},null,512),[[b,a.value.lastName]])])):c("",!0),(J=k.value)!=null&&J.isAdmin?(i(),u("div",Te,[e[25]||(e[25]=t("label",{class:"form-label",for:"isAdmin"},"Admin",-1)),t("label",ze,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.isAdmin=n),type:"checkbox",id:"isAdmin"},null,512),[[me,a.value.isAdmin]]),e[24]||(e[24]=t("span",{class:"slider round"},null,-1))])])):c("",!0),e[37]||(e[37]=t("h3",{class:"form-label"},"Passwort ändern",-1)),t("div",Ke,[e[26]||(e[26]=t("input",{type:"text",style:{display:"none"},autocomplete:"username"},null,-1)),e[27]||(e[27]=t("label",{for:"newPassword",class:"form-label"},"Neues Passwort",-1)),t("div",qe,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),type:B.value?"text":"password",id:"newPassword",class:"form-control",placeholder:"Neues Passwort",autocomplete:"off"},null,8,Je),[[R,w.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[5]||(e[5]=n=>N(!0)),onMouseup:e[6]||(e[6]=n=>N(!1)),onMouseleave:e[7]||(e[7]=n=>N(!1))},[t("i",{class:P(B.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),e[28]||(e[28]=t("label",{for:"confirmPassword",class:"form-label"},"Passwort bestätigen",-1)),t("div",Le,[p(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>x.value=n),type:B.value?"text":"password",id:"confirmPassword",class:"form-control",placeholder:"Passwort bestätigen",autocomplete:"off"},null,8,Ye),[[R,x.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[9]||(e[9]=n=>N(!0)),onMouseup:e[10]||(e[10]=n=>N(!1)),onMouseleave:e[11]||(e[11]=n=>N(!1))},[t("i",{class:P(B.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),E.value?(i(),u("p",je,"Die Passwörter stimmen nicht überein.")):c("",!0)]),e[38]||(e[38]=t("h3",{class:"mt-4 form-label"},"Adressenangabe",-1)),(L=a.value)!=null&&L.address?(i(),u("div",Ge,[e[29]||(e[29]=t("label",{for:"street",class:"form-label"},"Straße*",-1)),p(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>a.value.address.street=n),type:"text",id:"street",class:"form-control",maxlength:"30",required:""},null,512),[[b,a.value.address.street]]),e[30]||(e[30]=t("label",{for:"houseNumber",class:"form-label"},"Hausnummer*",-1)),p(t("input",{"onUpdate:modelValue":e[13]||(e[13]=n=>a.value.address.houseNumber=n),type:"text",id:"houseNumber",class:"form-control",maxlength:"8",required:""},null,512),[[b,a.value.address.houseNumber]]),e[31]||(e[31]=t("label",{for:"addressAddition",class:"form-label"},"Adresszusatz",-1)),p(t("input",{"onUpdate:modelValue":e[14]||(e[14]=n=>a.value.address.addressAddition=n),type:"text",id:"addressAddition",class:"form-control",maxlength:"150"},null,512),[[b,a.value.address.addressAddition]]),e[32]||(e[32]=t("label",{for:"city",class:"form-label"},"Stadt*",-1)),p(t("input",{"onUpdate:modelValue":e[15]||(e[15]=n=>a.value.address.city=n),type:"text",id:"city",class:"form-control",maxlength:"50",required:""},null,512),[[b,a.value.address.city]]),e[33]||(e[33]=t("label",{for:"postalCode",class:"form-label"},"Postleitzahl*",-1)),p(t("input",{"onUpdate:modelValue":e[16]||(e[16]=n=>a.value.address.postalCode=n),type:"text",id:"postalCode",class:"form-control",maxlength:"10",required:""},null,512),[[b,a.value.address.postalCode]]),e[34]||(e[34]=t("label",{for:"country",class:"form-label"},"Land*",-1)),p(t("input",{"onUpdate:modelValue":e[17]||(e[17]=n=>a.value.address.country=n),type:"text",id:"country",class:"form-control",maxlength:"60",required:""},null,512),[[b,a.value.address.country]])])):c("",!0),e[39]||(e[39]=t("h3",{class:"form-label"},"Zahlungsmethoden",-1)),t("div",Re,[a.value.payments.length>0?(i(),u("div",He,[(i(!0),u(pe,null,ce(a.value.payments,n=>(i(),u("div",{key:n.id,class:"payment-summary"},[t("div",Qe,[t("div",We,[n.paymentOption==="bank transfer"?(i(),u("i",Xe)):n.paymentOption==="credit card"?(i(),u("i",_e)):n.paymentOption==="paypal"?(i(),u("i",et)):c("",!0)]),t("div",tt,[t("strong",null,g(n.paymentOption),1),n.paymentOption==="bank transfer"?(i(),u("p",at," IBAN: "+g(te(n.iban)),1)):n.paymentOption==="credit card"?(i(),u("p",st,[H(" Nummer: "+g(ee(n.creditCardNumber)),1),e[35]||(e[35]=t("br",null,null,-1)),H(" Ablaufdatum: "+g(T(n.expiryDate)||"n/a"),1)])):n.paymentOption==="paypal"?(i(),u("p",rt," E-Mail: "+g(ae(n.paypalEmail)),1)):c("",!0)])]),t("div",nt,[t("button",{type:"button",onClick:se=>s(n),class:"btn btn-primary"}," Bearbeiten ",8,lt),t("button",{type:"button",onClick:se=>m(n.id),class:"btn btn-secondary"}," Löschen ",8,ot)])]))),128))])):(i(),u("div",it,e[36]||(e[36]=[t("p",null,"Keine Zahlungsmethoden hinterlegt.",-1)]))),t("button",{type:"button",class:"btn btn-primary",style:{"margin-top":"5px"},onClick:v}," Zahlungsmethode hinzufügen ")]),e[40]||(e[40]=t("hr",{class:"section-divider"},null,-1)),t("div",dt,[t("button",{type:"submit",class:"btn btn-primary",disabled:!I.value}," Speichern ",8,ut),(Y=k.value)!=null&&Y.isAdmin&&((j=a.value)!=null&&j.id)?(i(),u("button",{key:0,type:"button",onClick:e[18]||(e[18]=n=>K(a.value.id)),class:"btn btn-secondary"}," Löschen ")):c("",!0)])],32),D.value?(i(),W(Ee,{key:0,show:D.value,payment:A.value,userId:a.value.id,onClose:O,onSave:_},null,8,["show","payment","userId"])):c("",!0)])):(i(),u("div",mt,e[41]||(e[41]=[t("p",null,"Fehler: Benutzerinformationen konnten nicht geladen werden.",-1)])))])}}},yt=Q(pt,[["__scopeId","data-v-e1c3564f"]]);export{yt as default};
