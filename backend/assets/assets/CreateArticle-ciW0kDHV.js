import{_ as K,r as i,l as j,p as N,x as Z,k as $,c as s,f as G,a as r,d as c,n as g,b as y,v as k,t as d,F as M,m as F,e as V,w as Q,o,y as J,s as H,q as _}from"./index-BT3okxWX.js";import{B as W}from"./BackButton-8ABwIVY3.js";const X={class:"create-article"},Y={key:0,class:"image-preview"},ee=["src"],te={key:0,class:"error"},ne={key:0,class:"error"},ae={key:0,class:"error"},re={key:0,class:"error"},le={class:"form-group"},ie=["value"],se={key:1,class:"selected-options"},oe={class:"form-group"},ue=["disabled"],ce={__name:"CreateArticle",setup(de){const u=i(""),b=i(""),p=i(""),m=i(""),v=i([]),w=i([]),h=i(null),B=i(null),x=i(null),q=i(null),D=i(null),z=H(),a=i({name:"",description:"",price:"",quantity:""}),R=t=>{const e=t.reduce((n,l)=>{const f=l.type||"Andere";return n[f]=n[f]||[],n[f].push(l),n},{});return Object.entries(e).map(([n,l])=>({type:n,categories:l}))};j(async()=>{try{const t=await N.get("/api/category");w.value=R(t.data)}catch(t){console.error("Fehler beim Laden der Kategorien:",t)}document.addEventListener("click",A)}),Z(()=>{document.removeEventListener("click",A)});const E=t=>{h.value=h.value===t?null:t},A=t=>{const e=B.value&&B.value.contains(t.target),n=x.value&&x.value.contains(t.target);!e&&!n&&(h.value=null)},I=()=>v.value.map(t=>{var e;return(e=w.value.flatMap(n=>n.categories).find(n=>n.id===t))==null?void 0:e.name}),P=t=>{const e=t.target.files;e&&e[0]&&(q.value=e[0],D.value=URL.createObjectURL(e[0]))};function U(){u.value.trim()?u.value.trim().length>30?a.value.name="Der Name darf max. 30 Zeichen lang sein":a.value.name="":a.value.name="Bitte einen Artikelnamen eingeben"}function L(){b.value.trim().length>512?a.value.description="Die Beschreibung darf max. 512 Zeichen lang sein.":a.value.description=""}function T(){const t=p.value;if(!t){a.value.price="Bitte einen Preis eingeben.";return}if(!/^\d+(\.\d{1,2})?$/.test(t)){a.value.price="Preis darf max. zwei Nachkommastellen haben.";return}const n=parseFloat(t);if(n<0||n>1e3){a.value.price="Preis muss zwischen 0 und 1000 liegen.";return}a.value.price=""}function O(){const t=m.value;if(t==null||t===""){a.value.quantity="Bitte eine Menge eingeben";return}if(isNaN(t)){a.value.quantity="Bitte eine gültige Menge eingeben";return}if(!Number.isInteger(t)){a.value.quantity="Bitte nur ganze Zahlen eingeben";return}if(t<0){a.value.quantity="Die Menge darf nicht negativ sein";return}if(t>1e5){a.value.quantity="Die Menge darf nicht mehr als 100000 sein";return}a.value.quantity=""}const C=$(()=>{const t=!!u.value.trim(),e=!!p.value,n=!!m.value;return!(a.value.name||a.value.description||a.value.price||a.value.quantity)&&t&&e&&n}),S=async()=>{var e,n;const t=new FormData;t.append("name",u.value),t.append("description",b.value),t.append("price",p.value),t.append("quantity",m.value),t.append("categories",JSON.stringify(v.value)),q.value instanceof File&&t.append("image",q.value);try{await N.post("/api/product",t),await _.fire({title:"Artikel erstellt!",text:`Artikel: "${u.value}" wurde erfolgreich erstellt.`,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),await z.push({name:"AdminDashboard"})}catch(l){console.error("Fehler beim Erstellen des Artikels:",l),await _.fire({title:"Fehler beim Erstellen des Artikels!",text:((n=(e=l.response)==null?void 0:e.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}};return(t,e)=>(o(),s("div",X,[G(W),e[13]||(e[13]=r("h2",{class:"page-title"},"Neuen Artikel erstellen",-1)),r("form",{onSubmit:Q(S,["prevent"]),class:"form-container",method:"post",enctype:"multipart/form-data"},[D.value?(o(),s("div",Y,[r("img",{src:D.value,alt:"Vorschau des hochgeladenen Bildes",class:"preview-image"},null,8,ee)])):c("",!0),r("div",{class:g(["form-group",{"has-error":a.value.name}])},[e[6]||(e[6]=r("label",{for:"name",class:"form-label"},"Artikelname",-1)),y(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>u.value=n),id:"name",class:"form-control",maxlength:"30",placeholder:"z.B. Sencha Green Tea",onInput:U,required:""},null,544),[[k,u.value]]),a.value.name?(o(),s("span",te,d(a.value.name),1)):c("",!0)],2),r("div",{class:g(["form-group",{"has-error":a.value.description}])},[e[7]||(e[7]=r("label",{for:"description",class:"form-label"},"Beschreibung",-1)),y(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>b.value=n),id:"description",class:"form-control",placeholder:"z.B. Dieser Tee...",onInput:L,maxlength:"512"},null,544),[[k,b.value]]),a.value.description?(o(),s("span",ne,d(a.value.description),1)):c("",!0)],2),r("div",{class:g(["form-group",{"has-error":a.value.price}])},[e[8]||(e[8]=r("label",{for:"price",class:"form-label"},"Preis in €",-1)),y(r("input",{type:"number",step:"0.01","onUpdate:modelValue":e[2]||(e[2]=n=>p.value=n),id:"price",class:"form-control",placeholder:"z.B. 12.99",onInput:T,min:"0",max:"1000",required:""},null,544),[[k,p.value]]),a.value.price?(o(),s("span",ae,d(a.value.price),1)):c("",!0)],2),r("div",{class:g(["form-group",{"has-error":a.value.quantity}])},[e[9]||(e[9]=r("label",{for:"price",class:"form-label"},"Menge in g (Gram)",-1)),y(r("input",{type:"number",step:"1","onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),id:"quantity",placeholder:"z.B. 100",class:"form-control",onInput:O,min:"1",max:"100000",required:""},null,544),[[k,m.value]]),a.value.quantity?(o(),s("span",re,d(a.value.quantity),1)):c("",!0)],2),r("div",le,[e[11]||(e[11]=r("label",{for:"categories",class:"form-label"},"Kategorien",-1)),r("button",{class:"dropdown-button",type:"button",onClick:e[4]||(e[4]=n=>E("categories")),ref_key:"dropdownButtonRef",ref:B}," ▾ Kategorien wählen ",512),h.value==="categories"?(o(),s("div",{key:0,class:"dropdown-menu",ref_key:"dropdownMenuRef",ref:x},[(o(!0),s(M,null,F(w.value,n=>(o(),s("div",{key:n.type},[r("strong",null,d(n.type),1),(o(!0),s(M,null,F(n.categories,l=>(o(),s("div",{key:l.id},[r("label",null,[y(r("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=f=>v.value=f),value:l.id},null,8,ie),[[J,v.value]]),V(" "+d(l.name),1)])]))),128))]))),128))],512)):c("",!0),v.value.length?(o(),s("div",se,[e[10]||(e[10]=r("strong",null,"Ausgewählt:",-1)),V(" "+d(I().join(", ")),1)])):c("",!0)]),r("div",oe,[e[12]||(e[12]=r("label",{for:"image",class:"form-label"},"Bild hochladen",-1)),r("input",{type:"file",id:"image",class:"form-control",onChange:P,accept:"image/*"},null,32)]),r("button",{type:"submit",class:g(["btn btn-primary w-100",{"btn-disabled":!C.value}]),disabled:!C.value}," Artikel erstellen ",10,ue)],32)]))}},ve=K(ce,[["__scopeId","data-v-ed1b69bd"]]);export{ve as default};
