import{_ as K,y as te,B as se,k as $,o,C as J,g as ae,c as i,a as s,b as d,D as re,v as p,d as b,w as L,T as le,q as u,p as P,u as ne,r as x,l as oe,f as ie,t as N,x as de,E as T,n as I,F as ue,m as me,A as pe,s as ce}from"./index-BtwKz26K.js";import{B as fe}from"./BackButton--LrscsgX.js";const be={class:"modal-container"},ve={class:"form-group"},ye={key:0,class:"payment-fields"},ge={class:"form-group"},he={class:"form-group"},we={class:"form-group"},xe={key:1,class:"payment-fields"},ke={class:"form-group"},Be={key:2,class:"payment-fields"},Ce={class:"form-group"},Ne={class:"modal-actions"},Pe=["disabled"],Ae={__name:"PaymentModal",props:{show:{type:Boolean,default:!1},payment:{type:Object,required:!0,default:()=>({})},userId:{type:Number,required:!0}},emits:["close","save"],setup(M,{emit:V}){const g=V,r=te({}),A=M;se(()=>A.payment,c=>{Object.assign(r,c||{})},{immediate:!0});const O=$(()=>{if(!r.paymentOption)return!0;switch(r.paymentOption){case"credit card":return!r.creditCardNumber||!r.expiryDate||!r.cvc;case"bank transfer":return!r.iban;case"paypal":return!r.paypalEmail;default:return!0}}),v=()=>{g("close")},h=async()=>{var c,t;try{const n={...r};n.user=A.userId;let f;r.id?f=await C(r.id,n):f=await B(n),g("save",f.data),g("close"),k(),r.id?await u.fire({title:"Zahlungsmethode updated!",text:"Zahlungsmethode wurde erfolgreich geupdated.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0}):await u.fire({title:"Zahlungsmethode erstellt!",text:"Zahlungsmethode wurde erfolgreich erstellt.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0})}catch(n){console.error("Fehler beim Speichern der Zahlungsmethode:",n),await u.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((t=(c=n.response)==null?void 0:c.data)==null?void 0:t.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},k=()=>{Object.assign(r,{paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""})};async function B(c){var t,n;try{return await P.post("/api/payment/create",c)}catch(f){console.error("Fehler beim Erstellen der Zahlung:",f),await u.fire({title:"Fehler beim Erstellen der Zahlung!",text:((n=(t=f.response)==null?void 0:t.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}async function C(c,t){var n,f;try{return await P.patch(`/api/payment/${c}`,t)}catch(y){console.error("Fehler beim Aktualisieren der Zahlung:",y),await u.fire({title:"Fehler beim Aktualisieren der Zahlung!",text:((f=(n=y.response)==null?void 0:n.data)==null?void 0:f.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}return(c,t)=>(o(),J(le,{name:"fade-modal"},{default:ae(()=>[M.show?(o(),i("div",{key:0,class:"modal-backdrop",onClick:L(v,["self"])},[s("div",be,[t[13]||(t[13]=s("h2",null,"Zahlungsmethode festlegen/bearbeiten",-1)),s("div",ve,[t[7]||(t[7]=s("label",{for:"paymentOption"},"Zahlungsoption",-1)),d(s("select",{id:"paymentOption","onUpdate:modelValue":t[0]||(t[0]=n=>r.paymentOption=n),class:"form-control"},t[6]||(t[6]=[s("option",{value:"credit card"},"Kreditkarte",-1),s("option",{value:"bank transfer"},"Banküberweisung",-1),s("option",{value:"paypal"},"PayPal",-1)]),512),[[re,r.paymentOption]])]),r.paymentOption==="credit card"?(o(),i("div",ye,[s("div",ge,[t[8]||(t[8]=s("label",{for:"creditCardNumber"},"Kartennummer",-1)),d(s("input",{id:"creditCardNumber",type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=n=>r.creditCardNumber=n),placeholder:"z.B. 1234 5678 9012 3456"},null,512),[[p,r.creditCardNumber]])]),s("div",he,[t[9]||(t[9]=s("label",{for:"expiryDate"},"Ablaufdatum",-1)),d(s("input",{id:"expiryDate",type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=n=>r.expiryDate=n),placeholder:"MM/YY"},null,512),[[p,r.expiryDate]])]),s("div",we,[t[10]||(t[10]=s("label",{for:"cvc"},"CVC",-1)),d(s("input",{id:"cvc",type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=n=>r.cvc=n),placeholder:"z.B. 123"},null,512),[[p,r.cvc]])])])):r.paymentOption==="bank transfer"?(o(),i("div",xe,[s("div",ke,[t[11]||(t[11]=s("label",{for:"iban"},"IBAN",-1)),d(s("input",{id:"iban",type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=n=>r.iban=n),placeholder:"z.B. DE89370400440532013000"},null,512),[[p,r.iban]])])])):r.paymentOption==="paypal"?(o(),i("div",Be,[s("div",Ce,[t[12]||(t[12]=s("label",{for:"paypalEmail"},"PayPal E-Mail",-1)),d(s("input",{id:"paypalEmail",type:"email",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=n=>r.paypalEmail=n),placeholder:"z.B. user@mail.com"},null,512),[[p,r.paypalEmail]])])])):b("",!0),s("div",Ne,[s("button",{class:"btn btn-primary",onClick:h,disabled:O.value}," Übernehmen ",8,Pe),s("button",{class:"btn btn-danger",onClick:v},"Abbrechen")])])])):b("",!0)]),_:1}))}},Oe=K(Ae,[["__scopeId","data-v-a50357ed"]]),Ue={class:"edit-user"},$e={key:0,class:"text-center"},Me={key:1},Ve={key:0,class:"form-group"},Se={id:"userId",class:"form-control static-field"},De={key:1,class:"form-group"},Ee={key:2,class:"form-group"},Fe={key:3,class:"form-group"},Ze={key:4,class:"form-group toggle-switch"},ze={class:"switch","aria-labelledby":"isAdmin"},Te={class:"form-group password-fields"},Ie={class:"password-input-group"},Ke=["type"],Je={class:"password-input-group"},Le=["type"],qe={key:0,class:"error-text"},je={key:5,class:"form-group address-fields"},Ge={class:"form-group"},Re={key:0},Ye={key:0},He={key:1},Qe={key:2},We=["onClick"],Xe=["onClick"],_e={key:1},et={class:"button-group"},tt=["disabled"],st={key:2,class:"text-center"},at={__name:"EditUser",setup(M){const V=ne(),g=$(()=>V.user),r=pe(),A=ce(),O=x(!0),v=x(""),h=x(""),k=x(!1),B=x(!1),C=x(null),c=x(null),t=x({id:null,emailAddress:"",firstName:"",lastName:"",isAdmin:!1,address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payments:[]}),n=$(()=>{const l=JSON.stringify(t.value.address)!==JSON.stringify(c.value.address),e=JSON.stringify(t.value)!==JSON.stringify(c.value),m=v.value!==""&&h.value!==""&&v.value===h.value;return(e||l||m)&&!f.value}),f=$(()=>v.value&&h.value&&v.value!==h.value),y=l=>{k.value=l};oe(async()=>{const l=r.params.id||g.value.id;await q(l)});const q=async l=>{O.value=!0;try{const{data:e}=await P.get(`/api/user/${l}`);t.value={...t.value,...e,address:{...t.value.address,...e.address},payments:e.payments||[]},c.value=JSON.parse(JSON.stringify(t.value))}catch(e){console.error("Fehler beim Laden des Benutzers:",e),await u.fire({title:"Benutzer konnte nicht geladen werden.",icon:"error",confirmButtonText:"OK"})}finally{O.value=!1}},j=async l=>{if((await u.fire({title:"User löschen?",text:"Möchten Sie diesen User wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await P.delete(`/api/user/${l}`),await u.fire({title:"Gelöscht",text:"Der User wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}),await A.push({name:"AdminDashboard"})}catch(m){console.error("Fehler beim Löschen des Users:",m),await u.fire({title:"Fehler beim Löschen des Users.",icon:"error",confirmButtonText:"OK"})}},G=async()=>{if(f.value){await u.fire({title:"Passwörter stimmen nicht überein.",icon:"error",confirmButtonText:"OK"});return}const l={emailAddress:t.value.emailAddress,firstName:t.value.firstName,lastName:t.value.lastName,isAdmin:t.value.isAdmin,address:t.value.address,password:v.value||void 0};try{await P.patch(`/api/user/${t.value.id}`,l),await u.fire({title:"Benutzerdaten erfolgreich aktualisiert!",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),A.go()}catch(e){console.error("Fehler beim Speichern des Benutzers:",e),await u.fire({title:"Fehler beim Speichern der Benutzerdaten.",icon:"error",confirmButtonText:"OK"})}},R=l=>{C.value={...l},B.value=!0},Y=async l=>{(await u.fire({title:"Zahlungsmethode löschen?",text:"Möchten Sie diese Zahlungsmethode wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed&&(await P.delete(`/api/payment/${l}`),t.value.payments=t.value.payments.filter(m=>m.id!==l),await u.fire({title:"Gelöscht",text:"Die Zahlungsmethode wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}))},H=()=>{C.value={paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""},B.value=!0},S=()=>{B.value=!1},Q=async l=>{var e,m;try{if(C.value.id){const w=t.value.payments.findIndex(U=>U.id===C.value.id);w!==-1&&(t.value.payments[w]=l)}else t.value.payments.push(l);S()}catch(w){console.error("Fehler beim Speichern der Zahlungsmethode:",w),await u.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((m=(e=w.response)==null?void 0:e.data)==null?void 0:m.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},W=l=>l?"**** **** **** "+l.slice(-4):"n/a",X=l=>{if(!l)return"n/a";const e=l.replace(/\s/g,"");return e.length<=6?e:e.slice(0,4)+" **** **** "+e.slice(-2)},_=l=>{if(!l)return"n/a";const[e,m]=l.split("@");return m?e[0]+"****@"+m:l};return(l,e)=>{var m,w,U,D,E,F,Z,z;return o(),i("div",Ue,[ie(fe),e[41]||(e[41]=s("h2",{class:"page-title form-label"},"Benutzer bearbeiten",-1)),O.value||!t.value?(o(),i("div",$e,e[19]||(e[19]=[s("p",null,"Lade Benutzer...",-1)]))):g.value?(o(),i("div",Me,[s("form",{onSubmit:L(G,["prevent"]),class:"form-container",autocomplete:"off"},[(m=t.value)!=null&&m.id?(o(),i("div",Ve,[e[20]||(e[20]=s("label",{for:"userId",class:"form-label"},"User ID",-1)),s("div",Se,N(t.value.id),1)])):b("",!0),(w=t.value)!=null&&w.emailAddress?(o(),i("div",De,[e[21]||(e[21]=s("label",{for:"email",class:"form-label"},"E-Mail-Adresse",-1)),d(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.emailAddress=a),type:"email",id:"email",class:"form-control",required:""},null,512),[[p,t.value.emailAddress]])])):b("",!0),(U=t.value)!=null&&U.firstName?(o(),i("div",Ee,[e[22]||(e[22]=s("label",{for:"firstName",class:"form-label"},"Vorname",-1)),d(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.firstName=a),type:"text",id:"firstName",class:"form-control",required:""},null,512),[[p,t.value.firstName]])])):b("",!0),(D=t.value)!=null&&D.lastName?(o(),i("div",Fe,[e[23]||(e[23]=s("label",{for:"lastName",class:"form-label"},"Nachname",-1)),d(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.lastName=a),type:"text",id:"lastName",class:"form-control",required:""},null,512),[[p,t.value.lastName]])])):b("",!0),(E=g.value)!=null&&E.isAdmin?(o(),i("div",Ze,[e[25]||(e[25]=s("label",{class:"form-label",for:"isAdmin"},"Admin",-1)),s("label",ze,[d(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.isAdmin=a),type:"checkbox",id:"isAdmin"},null,512),[[de,t.value.isAdmin]]),e[24]||(e[24]=s("span",{class:"slider round"},null,-1))])])):b("",!0),e[37]||(e[37]=s("h3",{class:"form-label"},"Passwort ändern",-1)),s("div",Te,[e[26]||(e[26]=s("input",{type:"text",style:{display:"none"},autocomplete:"username"},null,-1)),e[27]||(e[27]=s("label",{for:"newPassword",class:"form-label"},"Neues Passwort",-1)),s("div",Ie,[d(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),type:k.value?"text":"password",id:"newPassword",class:"form-control",placeholder:"Neues Passwort",autocomplete:"off"},null,8,Ke),[[T,v.value]]),s("button",{type:"button",class:"btn btn-show-password",onMousedown:e[5]||(e[5]=a=>y(!0)),onMouseup:e[6]||(e[6]=a=>y(!1)),onMouseleave:e[7]||(e[7]=a=>y(!1))},[s("i",{class:I(k.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),e[28]||(e[28]=s("label",{for:"confirmPassword",class:"form-label"},"Passwort bestätigen",-1)),s("div",Je,[d(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),type:k.value?"text":"password",id:"confirmPassword",class:"form-control",placeholder:"Passwort bestätigen",autocomplete:"off"},null,8,Le),[[T,h.value]]),s("button",{type:"button",class:"btn btn-show-password",onMousedown:e[9]||(e[9]=a=>y(!0)),onMouseup:e[10]||(e[10]=a=>y(!1)),onMouseleave:e[11]||(e[11]=a=>y(!1))},[s("i",{class:I(k.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),f.value?(o(),i("p",qe,"Die Passwörter stimmen nicht überein.")):b("",!0)]),e[38]||(e[38]=s("h3",{class:"mt-4 form-label"},"Adressenangabe",-1)),(F=t.value)!=null&&F.address?(o(),i("div",je,[e[29]||(e[29]=s("label",{for:"street",class:"form-label"},"Straße*",-1)),d(s("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>t.value.address.street=a),type:"text",id:"street",class:"form-control"},null,512),[[p,t.value.address.street]]),e[30]||(e[30]=s("label",{for:"houseNumber",class:"form-label"},"Hausnummer*",-1)),d(s("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>t.value.address.houseNumber=a),type:"text",id:"houseNumber",class:"form-control"},null,512),[[p,t.value.address.houseNumber]]),e[31]||(e[31]=s("label",{for:"addressAddition",class:"form-label"},"Adresszusatz",-1)),d(s("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>t.value.address.addressAddition=a),type:"text",id:"addressAddition",class:"form-control"},null,512),[[p,t.value.address.addressAddition]]),e[32]||(e[32]=s("label",{for:"city",class:"form-label"},"Stadt*",-1)),d(s("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>t.value.address.city=a),type:"text",id:"city",class:"form-control"},null,512),[[p,t.value.address.city]]),e[33]||(e[33]=s("label",{for:"postalCode",class:"form-label"},"Postleitzahl*",-1)),d(s("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>t.value.address.postalCode=a),type:"text",id:"postalCode",class:"form-control"},null,512),[[p,t.value.address.postalCode]]),e[34]||(e[34]=s("label",{for:"country",class:"form-label"},"Land*",-1)),d(s("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>t.value.address.country=a),type:"text",id:"country",class:"form-control"},null,512),[[p,t.value.address.country]])])):b("",!0),s("div",Ge,[e[36]||(e[36]=s("h3",{class:"form-label"},"Zahlungsmethoden",-1)),t.value.payments.length>0?(o(),i("div",Re,[(o(!0),i(ue,null,me(t.value.payments,a=>(o(),i("div",{key:a.id,class:"payment-summary"},[s("strong",null,N(a.paymentOption),1),a.paymentOption==="bank transfer"?(o(),i("div",Ye,[s("p",null,"IBAN: "+N(X(a.iban)),1)])):a.paymentOption==="credit card"?(o(),i("div",He,[s("p",null,"Nummer: "+N(W(a.creditCardNumber)),1),s("p",null,"Ablaufdatum: "+N(a.expiryDate||"n/a"),1)])):a.paymentOption==="paypal"?(o(),i("div",Qe,[s("p",null,"E-Mail: "+N(_(a.paypalEmail)),1)])):b("",!0),s("button",{type:"button",onClick:ee=>R(a),class:"btn btn-edit-payment"}," Bearbeiten ",8,We),s("button",{type:"button",onClick:ee=>Y(a.id),class:"btn btn-delete-payment"}," Löschen ",8,Xe)]))),128))])):(o(),i("div",_e,e[35]||(e[35]=[s("p",null,"Keine Zahlungsmethoden hinterlegt.",-1)]))),s("button",{type:"button",class:"btn btn-secondary",onClick:H}," Zahlungsmethode hinzufügen ")]),e[39]||(e[39]=s("hr",{class:"section-divider"},null,-1)),s("div",et,[s("button",{type:"submit",class:"save-btn btn",style:{"background-color":"#4a5043",color:"white"},disabled:!n.value}," Speichern ",8,tt),(Z=g.value)!=null&&Z.isAdmin&&((z=t.value)!=null&&z.id)?(o(),i("button",{key:0,type:"button",onClick:e[18]||(e[18]=a=>j(t.value.id)),class:"btn btn-danger"}," Löschen ")):b("",!0)])],32),B.value?(o(),J(Oe,{key:0,show:B.value,payment:C.value,userId:t.value.id,onClose:S,onSave:Q},null,8,["show","payment","userId"])):b("",!0)])):(o(),i("div",st,e[40]||(e[40]=[s("p",null,"Fehler: Benutzerinformationen konnten nicht geladen werden.",-1)])))])}}},nt=K(at,[["__scopeId","data-v-4f54bcea"]]);export{nt as default};
