import{_ as E,r as i,l as $,y as O,p as f,c as a,f as j,a as l,b as u,s as B,d as m,v as g,F as C,m as x,e as q,t as h,w as z,z as I,o as n,q as K}from "./index-BqdhdNvZ.js";import{B as T}from "./BackButton-BFV3CPRB.js";const P={class:"edit-article"},G={key:0,class:"text-center"},J={key:1},H={key:0,class:"form-group toggle-switch"},Q={class:"switch","aria-labelledby":"isDeleted"},W={key:1,class:"image-preview"},X=["src"],Y={class:"form-group"},Z={class:"form-group"},ee={class:"form-group"},te={class:"form-group"},le={class:"form-group"},se=["value"],oe={key:1,class:"selected-options"},ae={class:"form-group"},ne={class:"button-group"},re={__name:"EditArticle",setup(ie){const V=I(),D=K(),b=i(!0),d=i([]),y=i([]),c=i(null),k=i(null),w=i(null),v=i(null),o=i({id:null,name:"",description:"",price:0,quantity:0,categories:[],image:null,isDeleted:!1}),L= s=>{const e=s.reduce((t, r)=>{const p=r.type||"Andere";return t[p]=t[p]||[],t[p].push(r),t},{});return Object.entries(e).map(([t,r])=>({type:t,categories:r}))},M=()=>d.value.map(s=>{var e;return(e=y.value.flatMap(t=>t.categories).find(t=>t.id===s))==null?void 0:e.name});$(async()=>{await U(),await R(V.params.id),v.value=o.value.image,document.addEventListener("click",A)}),O(()=>{document.removeEventListener("click",A)});const F= s=>{c.value===s?c.value=null:c.value=s},A= s=>{const e=k.value&&k.value.contains(s.target),t=w.value&&w.value.contains(s.target);!e&&!t&&(c.value=null)},U=async()=>{try{const{data:s}=await f.get("/category");y.value=L(s)}catch(s){console.error("Fehler beim Laden der Kategorien:",s)}},R=async s=>{b.value=!0;try{const{data:e}=await f.get(`/product/${s}`);e.isDeleted=!!e.isDeleted,o.value=e,d.value=e.productCategories.map(t=>t.id)}catch(e){console.error("Fehler beim Laden des Artikels:",e)}finally{b.value=!1}},N=async()=>{const s=new FormData;s.append("name",o.value.name),s.append("description",o.value.description),s.append("price",o.value.price),s.append("quantity",o.value.quantity),s.append("isDeleted",o.value.isDeleted),s.append("categories",JSON.stringify(d.value)),o.value.image instanceof File&&s.append("image",o.value.image);try{await f.patch(`/product/${o.value.id}`,s),await D.push("/admin")}catch(e){console.error("Fehler beim Speichern des Artikels:",e)}},S=async s=>{if(window.confirm("Möchten Sie diesen Artikel wirklich löschen?"))try{await f.delete(`/product/${s}`),await D.push("/admin")}catch(t){console.error("Fehler beim Löschen des Artikels:",t)}},_= s=>{const e=s.target.files;e&&e[0]&&(o.value.image=e[0],v.value=URL.createObjectURL(e[0]))};return(s, e)=>(n(),a("div",P,[j(T),e[19]||(e[19]=l("h2",{class:"page-title"},"Artikel bearbeiten",-1)),b.value?(n(),a("div",G,e[8]||(e[8]=[l("p",null,"Lade Artikel...",-1)]))):(n(),a("div",J,[l("form",{onSubmit:z(N,["prevent"]),class:"form-container",method:"post",enctype:"multipart/form-data"},[o.value.id?(n(),a("div",H,[e[10]||(e[10]=l("label",{class:"form-label",for:"isDeleted"},"Als gelöscht markieren",-1)),l("label",Q,[u(l("input",{"onUpdate:modelValue":e[0]||(e[0]= t=>o.value.isDeleted=t),type:"checkbox",id:"isDeleted"},null,512),[[B,o.value.isDeleted]]),e[9]||(e[9]=l("span",{class:"slider round"},null,-1))])])):m("",!0),v.value?(n(),a("div",W,[l("img",{src:v.value,alt:"Vorschau des hochgeladenen Bildes",class:"preview-image"},null,8,X)])):m("",!0),l("div",Y,[e[11]||(e[11]=l("label",{for:"name",class:"form-label"},"Artikelname",-1)),u(l("input",{"onUpdate:modelValue":e[1]||(e[1]= t=>o.value.name=t),type:"text",id:"name",class:"form-control",required:""},null,512),[[g,o.value.name]])]),l("div",Z,[e[12]||(e[12]=l("label",{for:"description",class:"form-label"},"Beschreibung",-1)),u(l("textarea",{"onUpdate:modelValue":e[2]||(e[2]= t=>o.value.description=t),id:"description",class:"form-control",required:""},null,512),[[g,o.value.description]])]),l("div",ee,[e[13]||(e[13]=l("label",{for:"price",class:"form-label"},"Preis",-1)),u(l("input",{"onUpdate:modelValue":e[3]||(e[3]= t=>o.value.price=t),type:"number",step:"0.01",id:"price",class:"form-control",required:""},null,512),[[g,o.value.price]])]),l("div",te,[e[14]||(e[14]=l("label",{for:"price",class:"form-label"},"Menge in g (Gram)",-1)),u(l("input",{type:"number",step:"0.01","onUpdate:modelValue":e[4]||(e[4]= t=>o.value.quantity=t),id:"quantity",class:"form-control",required:""},null,512),[[g,o.value.quantity]])]),l("div",le,[e[16]||(e[16]=l("label",{for:"categories",class:"form-label"},"Kategorien",-1)),l("button",{class:"dropdown-button",type:"button",onClick:e[5]||(e[5]= t=>F("categories")),ref_key:"dropdownButtonRef",ref:k}," ▾ Kategorien wählen ",512),c.value==="categories"?(n(),a("div",{key:0,class:"dropdown-menu",ref_key:"dropdownMenuRef",ref:w},[(n(!0),a(C,null,x(y.value, t=>(n(),a("div",{key:t.type},[l("strong",null,h(t.type),1),(n(!0),a(C,null,x(t.categories, r=>(n(),a("div",{key:r.id},[l("label",null,[u(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]= p=>d.value=p),value:r.id},null,8,se),[[B,d.value]]),q(" "+h(r.name),1)])]))),128))]))),128))],512)):m("",!0),d.value.length?(n(),a("div",oe,[e[15]||(e[15]=l("strong",null,"Ausgewählt:",-1)),q(" "+h(M().join(", ")),1)])):m("",!0)]),l("div",ae,[e[17]||(e[17]=l("label",{for:"image",class:"form-label"},"Neues Bild hochladen",-1)),l("input",{type:"file",id:"image",class:"form-control",onChange:_,accept:"image/*"},null,32)]),l("div",ne,[e[18]||(e[18]=l("button",{type:"submit",class:"btn btn-primary"},"Speichern",-1)),o.value.isDeleted?m("",!0):(n(),a("button",{key:0,type:"button",onClick:e[7]||(e[7]= t=>S(o.value.id)),class:"btn btn-danger"}," Löschen "))])],32)]))]))}},ce=E(re,[["__scopeId","data-v-be64036c"]]);export{ce as default};
