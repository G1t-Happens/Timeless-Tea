import{_ as w,o as i,B as R,g as N,c as d,a as e,F as V,m as O,t as l,e as v,d as x,w as G,T as H,G as K,u as L,r as k,k as T,l as j,f as c,i as C,b as m,v as p,s as W,p as $,h as J,n as Q,q as X}from "./index-S2dVXRzt.js";import{B as Y}from "./BackButton-CpLP0EiE.js";const _={class:"modal-container"},ee={class:"order-summary"},te={class:"summary-table"},se={class:"summary-total"},le={class:"user-info"},ne={class:"payment-info"},ie={key:0},de={key:0},ae={key:1},oe={key:2},re={key:1},ue={class:"shipping-info"},me={key:0},pe={key:1},ye={key:0},ve={key:1},be={__name:"OrderConfirmationModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0},cartItems:{type:Array,required:!0},totalAmount:{type:Number,required:!0},payment:{type:Object,required:!1},useBillingAsShipping:{type:Boolean,required:!0},shippingAddress:{type:Object,required:!0}},emits:["close","confirm"],setup(n, {emit:b}){const A=b,B=()=>A("close"),f=()=>A("confirm");return(g, a)=>(i(),R(H,{name:"fade-modal"},{default:N(()=>[n.show?(i(),d("div",{key:0,class:"modal-backdrop",onClick:G(B,["self"])},[e("div",_,[a[8]||(a[8]=e("h2",null,"Bestellzusammenfassung",-1)),e("div",ee,[a[1]||(a[1]=e("h3",null,"Produkte",-1)),e("table",te,[a[0]||(a[0]=e("thead",null,[e("tr",null,[e("th",null,"Produkt"),e("th",null,"Artikel"),e("th",null,"Preis (€)"),e("th",null,"Gesamt (€)")])],-1)),e("tbody",null,[(i(!0),d(V,null,O(n.cartItems, y=>(i(),d("tr",{key:y.productId},[e("td",null,l(y.name),1),e("td",null,l(y.quantity),1),e("td",null,l(y.price.toFixed(2)),1),e("td",null,l((y.price*y.quantity).toFixed(2)),1)]))),128))])]),e("div",se,[e("strong",null,"Gesamtsumme: "+l(n.totalAmount.toFixed(2))+" €",1)])]),e("div",le,[a[2]||(a[2]=e("h3",null,"Rechnungsadresse",-1)),e("p",null,l(n.user.firstName)+" "+l(n.user.lastName),1),e("p",null,l(n.user.emailAddress),1),e("p",null,l(n.user.address.street)+" "+l(n.user.address.houseNumber)+", "+l(n.user.address.postalCode)+" "+l(n.user.address.city)+", "+l(n.user.address.country),1)]),e("div",ne,[a[5]||(a[5]=e("h3",null,"Zahlungsmethode",-1)),n.payment&&n.payment.paymentOption?(i(),d("p",ie,[v(" Option: "+l(n.payment.paymentOption),1),a[4]||(a[4]=e("br",null,null,-1)),n.payment.paymentOption==="bank transfer"?(i(),d("span",de," IBAN: "+l(n.payment.iban),1)):n.payment.paymentOption==="credit card"?(i(),d("span",ae,[v(" Kreditkartennummer: **** **** **** "+l(n.payment.creditCardNumber.slice(-4)),1),a[3]||(a[3]=e("br",null,null,-1)),v(" Ablaufdatum: "+l(n.payment.expiryDate||"n/a"),1)])):n.payment.paymentOption==="paypal"?(i(),d("span",oe," PayPal E-Mail: "+l(n.payment.paypalEmail),1)):x("",!0)])):(i(),d("p",re,"Keine Zahlungsmethode hinterlegt."))]),e("div",ue,[a[7]||(a[7]=e("h3",null,"Versandinformationen",-1)),n.useBillingAsShipping?(i(),d("div",me,a[6]||(a[6]=[e("p",null,"Die Versandadresse entspricht der Rechnungsadresse.",-1)]))):(i(),d("div",pe,[e("p",null,l(n.shippingAddress.street)+" "+l(n.shippingAddress.houseNumber)+", "+l(n.shippingAddress.postalCode)+" "+l(n.shippingAddress.city)+", "+l(n.shippingAddress.country),1),n.shippingAddress.addressAddition?(i(),d("p",ye," Zusatz: "+l(n.shippingAddress.addressAddition),1)):x("",!0),n.shippingAddress.state?(i(),d("p",ve,"Bundesland: "+l(n.shippingAddress.state),1)):x("",!0)]))]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-success",onClick:f},"Bestellung bestätigen"),e("button",{class:"btn btn-danger",onClick:B},"Abbrechen")])])])):x("",!0)]),_:1}))}},he=w(be,[["__scopeId","data-v-890b1e2b"]]),fe={class:"checkout"},ge={key:0,class:"empty-cart"},ke={key:1,class:"checkout-container"},ce={class:"order-summary"},Ae={class:"summary-table"},Ce={class:"summary-total"},Ne={class:"user-details"},xe={class:"edit-hint"},Be={class:"detail-item"},Ve={class:"detail-item"},Oe={class:"detail-item"},Se={class:"detail-item"},Ue={class:"detail-item"},$e={class:"detail-item"},we={class:"detail-item"},Ie={class:"detail-item"},Pe={class:"payment-method"},qe={class:"edit-hint"},Fe={key:0,class:"payment-list-container"},Me=["onClick"],Ee={class:"payment-option"},ze={key:0},De={key:1},Ze={key:2},Re={key:1},Ge={class:"shipping-info"},He={class:"checkbox-wrapper"},Ke={key:0},Le={key:1},Te={class:"detail-item"},je={class:"detail-item"},We={class:"detail-item"},Je={class:"detail-item"},Qe={class:"detail-item"},Xe={class:"detail-item"},Ye={class:"detail-item"},_e={class:"checkout-actions"},et=["disabled"],tt={__name:"CheckOut",setup(n){const b=K(),A=L(),B=X(),f=k([]),g=k(null),a=k(!1),y=k(!0),u=k({}),r=k({id:null,emailAddress:"",firstName:"",lastName:"",address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payment:{paymentOption:null,iban:null,creditCardNumber:null,expiryDate:null,cvc:null,paypalEmail:null}}),S=T(()=>b.items.length>0&&A.user&&r.value.address&&g.value),I=()=>f.value.find(o=>o.id===g.value)||null,P=async()=>{try{const o=await $.get(`/api/user/${A.user.id}`);r.value=o.data,f.value=o.data.payments.filter(t=>!t.isForOrder)}catch(o){console.error("Fehler beim Laden des Benutzers oder der Zahlungsdaten:",o)}},q= o=>o?"**** **** **** "+o.slice(-4):"n/a",F= o=>{if(!o)return"n/a";const t=o.replace(/\s/g,"");return t.slice(0,4)+" **** **** "+t.slice(-2)},M= o=>{if(!o)return"n/a";const[t,h]=o.split("@");return t[0]+"****@"+h},E= o=>{g.value=o},z=()=>{a.value=!0},U=()=>{a.value=!1},D=async()=>{U(),await Z()},Z=async()=>{if(!S.value){alert("Bitte stellen Sie sicher, dass alle erforderlichen Informationen ausgefüllt sind.");return}try{const o={totalAmount:parseFloat(b.totalAmount),payment:g.value,orderProducts:b.items.map(h=>({product:h.productId,quantity:h.quantity})),newShippingAddress:y.value?null:{...u.value}},t=await $.post("/api/order",o);b.clearCart(),await B.push({name:"OrderSuccess",query:{id:t.data.id}})}catch(o){console.error("Fehler beim Abschicken der Bestellung:",o),alert("Fehler beim Abschicken der Bestellung.")}};return j(async()=>{await P()}),(o, t)=>{const h=J("router-link");return i(),d("div",fe,[t[50]||(t[50]=e("h1",{class:"checkout-title"},"Checkout",-1)),c(Y),C(b).items.length===0?(i(),d("div",ge,[t[17]||(t[17]=e("p",null,"Ihr Warenkorb ist leer.",-1)),c(h,{to:"/",class:"btn btn-primary"},{default:N(()=>t[16]||(t[16]=[v("Zurück zum Shop")])),_:1})])):(i(),d("div",ke,[e("div",ce,[t[19]||(t[19]=e("h2",null,"Bestellübersicht",-1)),e("table",Ae,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",null,"Produkt"),e("th",null,"Artikel"),e("th",null,"Preis (€)"),e("th",null,"Gesamt (€)")])],-1)),e("tbody",null,[(i(!0),d(V,null,O(C(b).items, s=>(i(),d("tr",{key:s.productId},[e("td",null,l(s.name),1),e("td",null,l(s.quantity),1),e("td",null,l(s.price.toFixed(2)),1),e("td",null,l((s.price*s.quantity).toFixed(2)),1)]))),128))])]),e("div",Ce,[e("strong",null,"Gesamtsumme: "+l(C(b).totalAmount)+" €",1)])]),e("div",Ne,[t[32]||(t[32]=e("h2",null,"Rechnungsadresse",-1)),e("p",xe,[t[21]||(t[21]=e("strong",null,"Hinweis:",-1)),t[22]||(t[22]=v(" Falls Sie Ihre Rechnungsadresse ändern möchten, können Sie das ")),c(h,{to:{name:"UserEditUser"}},{default:N(()=>t[20]||(t[20]=[v("hier")])),_:1}),t[23]||(t[23]=v(" erledigen. "))]),e("div",Be,[t[24]||(t[24]=e("label",{for:"firstName"},"Vorname:",-1)),m(e("input",{id:"firstName",type:"text","onUpdate:modelValue":t[0]||(t[0]= s=>r.value.firstName=s),disabled:""},null,512),[[p,r.value.firstName]])]),e("div",Ve,[t[25]||(t[25]=e("label",{for:"lastName"},"Nachname:",-1)),m(e("input",{id:"lastName",type:"text","onUpdate:modelValue":t[1]||(t[1]= s=>r.value.lastName=s),disabled:""},null,512),[[p,r.value.lastName]])]),e("div",Oe,[t[26]||(t[26]=e("label",{for:"email"},"E-Mail:",-1)),m(e("input",{id:"email",type:"email","onUpdate:modelValue":t[2]||(t[2]= s=>r.value.emailAddress=s),disabled:""},null,512),[[p,r.value.emailAddress]])]),e("div",Se,[t[27]||(t[27]=e("label",{for:"country"},"Land:",-1)),m(e("input",{id:"country",type:"text","onUpdate:modelValue":t[3]||(t[3]= s=>r.value.address.country=s),disabled:""},null,512),[[p,r.value.address.country]])]),e("div",Ue,[t[28]||(t[28]=e("label",{for:"postalCode"},"Postleitzahl:",-1)),m(e("input",{id:"postalCode",type:"text","onUpdate:modelValue":t[4]||(t[4]= s=>r.value.address.postalCode=s),disabled:""},null,512),[[p,r.value.address.postalCode]])]),e("div",$e,[t[29]||(t[29]=e("label",{for:"city"},"Stadt:",-1)),m(e("input",{id:"city",type:"text","onUpdate:modelValue":t[5]||(t[5]= s=>r.value.address.city=s),disabled:""},null,512),[[p,r.value.address.city]])]),e("div",we,[t[30]||(t[30]=e("label",{for:"street"},"Straße:",-1)),m(e("input",{id:"street",type:"text","onUpdate:modelValue":t[6]||(t[6]= s=>r.value.address.street=s),disabled:""},null,512),[[p,r.value.address.street]])]),e("div",Ie,[t[31]||(t[31]=e("label",{for:"houseNumber"},"Hausnummer:",-1)),m(e("input",{id:"houseNumber",type:"text","onUpdate:modelValue":t[7]||(t[7]= s=>r.value.address.houseNumber=s),disabled:""},null,512),[[p,r.value.address.houseNumber]])])]),e("div",Pe,[t[39]||(t[39]=e("h2",null,"Zahlungsmethode",-1)),e("p",qe,[t[34]||(t[34]=e("strong",null,"Hinweis:",-1)),t[35]||(t[35]=v(" Wählen Sie eine der hinterlegten Zahlungsmethoden aus oder ")),c(h,{to:{name:"UserEditUser"}},{default:N(()=>t[33]||(t[33]=[v("fügen Sie eine neue hinzu.")])),_:1})]),f.value.length>0?(i(),d("div",Fe,[(i(!0),d(V,null,O(f.value, s=>(i(),d("div",{key:s.id,class:Q(["payment-panel",{active:g.value===s.id}]),onClick: st=>E(s.id)},[e("p",Ee,"Option: "+l(s.paymentOption),1),s.paymentOption==="bank transfer"?(i(),d("div",ze,[e("p",null,"IBAN: "+l(F(s.iban)),1)])):s.paymentOption==="credit card"?(i(),d("div",De,[e("p",null,"Kreditkartennummer: "+l(q(s.creditCardNumber)),1),e("p",null,"Ablaufdatum: "+l(s.expiryDate||"n/a"),1)])):s.paymentOption==="paypal"?(i(),d("div",Ze,[e("p",null,"PayPal E-Mail: "+l(M(s.paypalEmail)),1)])):x("",!0)],10,Me))),128))])):(i(),d("div",Re,[e("p",null,[t[37]||(t[37]=v(" Keine Zahlungsmethode hinterlegt. Bitte ")),c(h,{to:{name:"UserEditUser"}},{default:N(()=>t[36]||(t[36]=[v(" hinterlegen Sie Ihre Zahlungsdaten! ")])),_:1}),t[38]||(t[38]=v(" . "))])]))]),e("div",Ge,[t[49]||(t[49]=e("h2",null,"Versandinformationen",-1)),e("div",He,[m(e("input",{type:"checkbox",id:"use-billing-as-shipping","onUpdate:modelValue":t[8]||(t[8]= s=>y.value=s)},null,512),[[W,y.value]]),t[40]||(t[40]=e("label",{for:"use-billing-as-shipping"}," Versandadresse ist identisch mit der Rechnungsadresse ",-1))]),y.value?(i(),d("div",Ke,t[41]||(t[41]=[e("p",null,"Die Versandadresse entspricht der oben angegebenen Rechnungsadresse.",-1)]))):(i(),d("div",Le,[e("div",Te,[t[42]||(t[42]=e("label",{for:"ship-country"},"Land*:",-1)),m(e("input",{id:"ship-country",type:"text","onUpdate:modelValue":t[9]||(t[9]= s=>u.value.country=s)},null,512),[[p,u.value.country]])]),e("div",je,[t[43]||(t[43]=e("label",{for:"ship-postal-code"},"Postleitzahl*:",-1)),m(e("input",{id:"ship-postal-code",type:"text","onUpdate:modelValue":t[10]||(t[10]= s=>u.value.postalCode=s)},null,512),[[p,u.value.postalCode]])]),e("div",We,[t[44]||(t[44]=e("label",{for:"ship-city"},"Stadt*:",-1)),m(e("input",{id:"ship-city",type:"text","onUpdate:modelValue":t[11]||(t[11]= s=>u.value.city=s)},null,512),[[p,u.value.city]])]),e("div",Je,[t[45]||(t[45]=e("label",{for:"ship-street"},"Straße*:",-1)),m(e("input",{id:"ship-street",type:"text","onUpdate:modelValue":t[12]||(t[12]= s=>u.value.street=s)},null,512),[[p,u.value.street]])]),e("div",Qe,[t[46]||(t[46]=e("label",{for:"ship-house-number"},"Hausnummer*:",-1)),m(e("input",{id:"ship-house-number",type:"text","onUpdate:modelValue":t[13]||(t[13]= s=>u.value.houseNumber=s)},null,512),[[p,u.value.houseNumber]])]),e("div",Xe,[t[47]||(t[47]=e("label",{for:"ship-addition"},"Adresszusatz (optional):",-1)),m(e("input",{id:"ship-addition",type:"text","onUpdate:modelValue":t[14]||(t[14]= s=>u.value.addressAddition=s)},null,512),[[p,u.value.addressAddition]])]),e("div",Ye,[t[48]||(t[48]=e("label",{for:"ship-state"},"Bundesland (optional):",-1)),m(e("input",{id:"ship-state",type:"text","onUpdate:modelValue":t[15]||(t[15]= s=>u.value.state=s)},null,512),[[p,u.value.state]])])]))]),e("div",_e,[e("button",{onClick:z,class:"btn btn-success",disabled:!S.value}," Bestellung abschicken ",8,et)])])),c(he,{show:a.value,user:r.value,cartItems:C(b).items,totalAmount:Number(C(b).totalAmount),payment:I(),useBillingAsShipping:y.value,shippingAddress:u.value,onClose:U,onConfirm:D},null,8,["show","user","cartItems","totalAmount","payment","useBillingAsShipping","shippingAddress"])])}}},it=w(tt,[["__scopeId","data-v-fd9b478f"]]);export{it as default};
