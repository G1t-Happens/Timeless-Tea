import{_ as R,r as u,l as N,z as _,p as g,q as d,c as s,f as P,a as r,b as p,x as D,d as f,v as b,F,m as C,e as L,t as x,w as $,A as j,o,s as z}from"./index-DH_gYooc.js";import{B as I}from"./BackButton-CpGm2r89.js";const G={class:"edit-article"},J={key:0,class:"text-center"},H={key:1},Q={key:0,class:"form-group toggle-switch"},W={class:"switch","aria-labelledby":"isDeleted"},X={key:1,class:"image-preview"},Y=["src"],Z={class:"form-group"},ee={class:"form-group"},te={class:"form-group"},re={class:"form-group"},ne={class:"form-group"},ae=["value"],ie={key:1,class:"selected-options"},se={class:"form-group"},oe={class:"button-group"},le={__name:"EditArticle",setup(ue){const V=j(),B=z(),k=u(!0),c=u([]),y=u([]),m=u(null),w=u(null),h=u(null),v=u(null),a=u({id:null,name:"",description:"",price:0,quantity:0,categories:[],image:null,isDeleted:!1}),q=n=>{const e=n.reduce((t,i)=>{const l=i.type||"Andere";return t[l]=t[l]||[],t[l].push(i),t},{});return Object.entries(e).map(([t,i])=>({type:t,categories:i}))},E=()=>c.value.map(n=>{var e;return(e=y.value.flatMap(t=>t.categories).find(t=>t.id===n))==null?void 0:e.name});N(async()=>{await T(),await U(V.params.id),v.value=a.value.image,document.addEventListener("click",A)}),_(()=>{document.removeEventListener("click",A)});const M=n=>{m.value===n?m.value=null:m.value=n},A=n=>{const e=w.value&&w.value.contains(n.target),t=h.value&&h.value.contains(n.target);!e&&!t&&(m.value=null)},T=async()=>{var n,e;try{const{data:t}=await g.get("/api/category");y.value=q(t)}catch(t){console.error("Fehler beim Laden der Kategorien:",t),await d.fire({title:"Fehler beim Laden der Kategorien!",text:((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},U=async n=>{var e,t;k.value=!0;try{const{data:i}=await g.get(`/api/product/${n}`);i.isDeleted=!!i.isDeleted,a.value=i,c.value=i.productCategories.map(l=>l.id)}catch(i){console.error("Fehler beim Laden des Artikels:",i),await d.fire({title:"Fehler beim Laden des Artikel!",text:((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}finally{k.value=!1}},K=async()=>{var e,t;const n=new FormData;n.append("name",a.value.name),n.append("description",a.value.description),n.append("price",a.value.price),n.append("quantity",a.value.quantity),n.append("isDeleted",a.value.isDeleted),n.append("categories",JSON.stringify(c.value)),a.value.image instanceof File&&n.append("image",a.value.image);try{await g.patch(`/api/product/${a.value.id}`,n),await d.fire({title:"Artikel geupdated!",text:`Artikel: "${a.value.name}" wurde erfolgreich geupdated.`,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),await B.push({name:"AdminDasboard"})}catch(i){console.error("Fehler beim Speichern des Artikels:",i),await d.fire({title:"Fehler beim Speichern des Artikels!",text:((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},O=async n=>{var t,i;if((await d.fire({title:"Produkt entfernen?",text:"Möchten Sie dieses Produkt wirklich entfernen? Dieser Vorgang kann im nachhinein über die Produkte Bearbeitungsseite rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, entfernen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await g.delete(`/api/product/${n}`),await d.fire({title:"Gelöscht",text:"Der User wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}),await B.push({name:"AdminDasboard"})}catch(l){console.error("Fehler beim Löschen des Artikels:",l),await d.fire({title:"Fehler beim Löschen des Artikels!",text:((i=(t=l.response)==null?void 0:t.data)==null?void 0:i.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},S=n=>{const e=n.target.files;e&&e[0]&&(a.value.image=e[0],v.value=URL.createObjectURL(e[0]))};return(n,e)=>(o(),s("div",G,[P(I),e[19]||(e[19]=r("h2",{class:"page-title"},"Artikel bearbeiten",-1)),k.value?(o(),s("div",J,e[8]||(e[8]=[r("p",null,"Lade Artikel...",-1)]))):(o(),s("div",H,[r("form",{onSubmit:$(K,["prevent"]),class:"form-container",method:"post",enctype:"multipart/form-data"},[a.value.id?(o(),s("div",Q,[e[10]||(e[10]=r("label",{class:"form-label",for:"isDeleted"},"Als gelöscht markieren",-1)),r("label",W,[p(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.isDeleted=t),type:"checkbox",id:"isDeleted"},null,512),[[D,a.value.isDeleted]]),e[9]||(e[9]=r("span",{class:"slider round"},null,-1))])])):f("",!0),v.value?(o(),s("div",X,[r("img",{src:v.value,alt:"Vorschau des hochgeladenen Bildes",class:"preview-image"},null,8,Y)])):f("",!0),r("div",Z,[e[11]||(e[11]=r("label",{for:"name",class:"form-label"},"Artikelname",-1)),p(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.name=t),type:"text",id:"name",class:"form-control",required:""},null,512),[[b,a.value.name]])]),r("div",ee,[e[12]||(e[12]=r("label",{for:"description",class:"form-label"},"Beschreibung",-1)),p(r("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.description=t),id:"description",class:"form-control",required:""},null,512),[[b,a.value.description]])]),r("div",te,[e[13]||(e[13]=r("label",{for:"price",class:"form-label"},"Preis",-1)),p(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.price=t),type:"number",step:"0.01",id:"price",class:"form-control",required:""},null,512),[[b,a.value.price]])]),r("div",re,[e[14]||(e[14]=r("label",{for:"price",class:"form-label"},"Menge in g (Gram)",-1)),p(r("input",{type:"number",step:"0.01","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.quantity=t),id:"quantity",class:"form-control",required:""},null,512),[[b,a.value.quantity]])]),r("div",ne,[e[16]||(e[16]=r("label",{for:"categories",class:"form-label"},"Kategorien",-1)),r("button",{class:"dropdown-button",type:"button",onClick:e[5]||(e[5]=t=>M("categories")),ref_key:"dropdownButtonRef",ref:w}," ▾ Kategorien wählen ",512),m.value==="categories"?(o(),s("div",{key:0,class:"dropdown-menu",ref_key:"dropdownMenuRef",ref:h},[(o(!0),s(F,null,C(y.value,t=>(o(),s("div",{key:t.type},[r("strong",null,x(t.type),1),(o(!0),s(F,null,C(t.categories,i=>(o(),s("div",{key:i.id},[r("label",null,[p(r("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>c.value=l),value:i.id},null,8,ae),[[D,c.value]]),L(" "+x(i.name),1)])]))),128))]))),128))],512)):f("",!0),c.value.length?(o(),s("div",ie,[e[15]||(e[15]=r("strong",null,"Ausgewählt:",-1)),L(" "+x(E().join(", ")),1)])):f("",!0)]),r("div",se,[e[17]||(e[17]=r("label",{for:"image",class:"form-label"},"Neues Bild hochladen",-1)),r("input",{type:"file",id:"image",class:"form-control",onChange:S,accept:"image/*"},null,32)]),r("div",oe,[e[18]||(e[18]=r("button",{type:"submit",class:"btn btn-primary"},"Speichern",-1)),a.value.isDeleted?f("",!0):(o(),s("button",{key:0,type:"button",onClick:e[7]||(e[7]=t=>O(a.value.id)),class:"btn btn-danger"}," Entfernen "))])],32)]))]))}},pe=R(le,[["__scopeId","data-v-f300f3cb"]]);export{pe as default};
