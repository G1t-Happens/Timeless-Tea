import{_ as S,x as R,A as Y,k as P,o as n,B as D,g as H,c as i,a as t,b as r,C as G,v as m,d as w,w as z,T as Q,p as h,u as W,r as v,l as X,f as _,t as N,s as ee,D as O,n as V,F as te,m as se,z as ae,q as le}from"./index-K1tN9E6u.js";import{B as oe}from"./BackButton-D8GlQKJ7.js";const ne={class:"modal-container"},re={class:"form-group"},ie={key:0,class:"payment-fields"},de={class:"form-group"},ue={class:"form-group"},me={class:"form-group"},pe={key:1,class:"payment-fields"},fe={class:"form-group"},ve={key:2,class:"payment-fields"},ye={class:"form-group"},ce={class:"modal-actions"},be=["disabled"],ge={__name:"PaymentModal",props:{show:{type:Boolean,default:!1},payment:{type:Object,required:!0,default:()=>({})},userId:{type:Number,required:!0}},emits:["close","save"],setup(A,{emit:U}){const y=U,o=R({}),C=A;Y(()=>C.payment,d=>{Object.assign(o,d||{})},{immediate:!0});const x=P(()=>{if(!o.paymentOption)return!0;switch(o.paymentOption){case"credit card":return!o.creditCardNumber||!o.expiryDate||!o.cvc;case"bank transfer":return!o.iban;case"paypal":return!o.paypalEmail;default:return!0}}),p=()=>{y("close")},f=async()=>{try{const d={...o};d.user=C.userId;let s;o.id?s=await g(o.id,d):s=await b(d),y("save",s.data),c(),y("close")}catch(d){console.error("Fehler beim Speichern der Zahlungsmethode:",d)}},c=()=>{Object.assign(o,{paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""})};async function b(d){try{return await h.post("/api/payment/create",d)}catch(s){console.error("Fehler beim Erstellen der Zahlung:",s)}}async function g(d,s){try{return await h.patch(`/api/payment/${d}`,s)}catch(u){console.error("Fehler beim Aktualisieren der Zahlung:",u)}}return(d,s)=>(n(),D(Q,{name:"fade-modal"},{default:H(()=>[A.show?(n(),i("div",{key:0,class:"modal-backdrop",onClick:z(p,["self"])},[t("div",ne,[s[13]||(s[13]=t("h2",null,"Zahlungsmethode festlegen/bearbeiten",-1)),t("div",re,[s[7]||(s[7]=t("label",{for:"paymentOption"},"Zahlungsoption",-1)),r(t("select",{id:"paymentOption","onUpdate:modelValue":s[0]||(s[0]=u=>o.paymentOption=u),class:"form-control"},s[6]||(s[6]=[t("option",{value:"credit card"},"Kreditkarte",-1),t("option",{value:"bank transfer"},"Banküberweisung",-1),t("option",{value:"paypal"},"PayPal",-1)]),512),[[G,o.paymentOption]])]),o.paymentOption==="credit card"?(n(),i("div",ie,[t("div",de,[s[8]||(s[8]=t("label",{for:"creditCardNumber"},"Kartennummer",-1)),r(t("input",{id:"creditCardNumber",type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=u=>o.creditCardNumber=u),placeholder:"z.B. 1234 5678 9012 3456"},null,512),[[m,o.creditCardNumber]])]),t("div",ue,[s[9]||(s[9]=t("label",{for:"expiryDate"},"Ablaufdatum",-1)),r(t("input",{id:"expiryDate",type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=u=>o.expiryDate=u),placeholder:"MM/YY"},null,512),[[m,o.expiryDate]])]),t("div",me,[s[10]||(s[10]=t("label",{for:"cvc"},"CVC",-1)),r(t("input",{id:"cvc",type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=u=>o.cvc=u),placeholder:"z.B. 123"},null,512),[[m,o.cvc]])])])):o.paymentOption==="bank transfer"?(n(),i("div",pe,[t("div",fe,[s[11]||(s[11]=t("label",{for:"iban"},"IBAN",-1)),r(t("input",{id:"iban",type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=u=>o.iban=u),placeholder:"z.B. DE89370400440532013000"},null,512),[[m,o.iban]])])])):o.paymentOption==="paypal"?(n(),i("div",ve,[t("div",ye,[s[12]||(s[12]=t("label",{for:"paypalEmail"},"PayPal E-Mail",-1)),r(t("input",{id:"paypalEmail",type:"email",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=u=>o.paypalEmail=u),placeholder:"z.B. user@mail.com"},null,512),[[m,o.paypalEmail]])])])):w("",!0),t("div",ce,[t("button",{class:"btn btn-primary",onClick:f,disabled:x.value}," Übernehmen ",8,be),t("button",{class:"btn btn-danger",onClick:p},"Abbrechen")])])])):w("",!0)]),_:1}))}},we=S(ge,[["__scopeId","data-v-98a6322a"]]),ke={class:"edit-user"},Ne={key:0,class:"text-center"},he={key:1},Ce={class:"form-group"},xe={id:"userId",class:"form-control static-field"},Pe={class:"form-group"},Ae={class:"form-group"},Ue={class:"form-group"},$e={key:0,class:"form-group toggle-switch"},Me={class:"switch","aria-labelledby":"isAdmin"},Be={class:"form-group password-fields"},Oe={class:"password-input-group"},Ve=["type"],Se={class:"password-input-group"},De=["type"],ze={key:0,class:"error-text"},Ee={class:"form-group address-fields"},Ie={class:"form-group"},Fe={key:0},Ze={key:0},Le={key:1},qe={key:2},Je=["onClick"],je=["onClick"],Ke={key:1},Te={class:"button-group"},Re=["disabled"],Ye={__name:"EditUser",setup(A){const U=W(),y=P(()=>U.user),o=ae(),C=le(),x=v(!0),p=v(""),f=v(""),c=v(!1),b=v(!1),g=v(null),d=v(null),s=v({id:null,emailAddress:"",firstName:"",lastName:"",isAdmin:!1,address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payments:[]}),u=P(()=>{const l=JSON.stringify(s.value.address)!==JSON.stringify(d.value.address),e=JSON.stringify(s.value)!==JSON.stringify(d.value),a=p.value!==""&&f.value!==""&&p.value===f.value;return(e||l||a)&&!$.value}),$=P(()=>p.value&&f.value&&p.value!==f.value),k=l=>{c.value=l};X(async()=>{const l=o.params.id||y.value.id;await M(l)});const M=async l=>{x.value=!0;try{const{data:e}=await h.get(`/api/user/${l}`);s.value={...s.value,...e,address:{...s.value.address,...e.address},payments:e.payments||[]},d.value=JSON.parse(JSON.stringify(s.value))}catch(e){console.error("Fehler beim Laden des Benutzers:",e),alert("Benutzer konnte nicht geladen werden.")}finally{x.value=!1}},E=async l=>{if(window.confirm("Möchten Sie diesen User wirklich löschen?"))try{await h.delete(`/api/user/${l}`),await C.push({name:"AdminDasboard"})}catch(a){console.error("Fehler beim Löschen des Users:",a),alert("Fehler beim Löschen des Users.")}},I=async()=>{if($.value){alert("Passwörter stimmen nicht überein.");return}const l={emailAddress:s.value.emailAddress,firstName:s.value.firstName,lastName:s.value.lastName,isAdmin:s.value.isAdmin,address:s.value.address,password:p.value||void 0};try{await h.patch(`/api/user/${s.value.id}`,l),alert("Benutzerdaten erfolgreich aktualisiert!"),C.go()}catch(e){console.error("Fehler beim Speichern des Benutzers:",e),alert("Fehler beim Speichern der Benutzerdaten")}},F=l=>{g.value={...l},b.value=!0},Z=async l=>{window.confirm("Möchten Sie diese Zahlungsmethode wirklich löschen?")&&(await h.delete(`/api/payment/${l}`),s.value.payments=s.value.payments.filter(a=>a.id!==l))},L=()=>{g.value={paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""},b.value=!0},B=()=>{b.value=!1},q=async l=>{try{if(g.value.id){const e=s.value.payments.findIndex(a=>a.id===g.value.id);e!==-1&&(s.value.payments[e]=l)}else s.value.payments.push(l);await M(s.value.id),B()}catch(e){console.error("Fehler beim Speichern der Zahlungsmethode:",e)}},J=l=>l?"**** **** **** "+l.slice(-4):"n/a",j=l=>{if(!l)return"n/a";const e=l.replace(/\s/g,"");return e.length<=6?e:e.slice(0,4)+" **** **** "+e.slice(-2)},K=l=>{if(!l)return"n/a";const[e,a]=l.split("@");return a?e[0]+"****@"+a:l};return(l,e)=>(n(),i("div",ke,[_(oe),e[40]||(e[40]=t("h2",{class:"page-title form-label"},"Benutzer bearbeiten",-1)),x.value||!s.value?(n(),i("div",Ne,e[19]||(e[19]=[t("p",null,"Lade Benutzer...",-1)]))):(n(),i("div",he,[t("form",{onSubmit:z(I,["prevent"]),class:"form-container",autocomplete:"off"},[t("div",Ce,[e[20]||(e[20]=t("label",{for:"userId",class:"form-label"},"User ID",-1)),t("div",xe,N(s.value.id),1)]),t("div",Pe,[e[21]||(e[21]=t("label",{for:"email",class:"form-label"},"E-Mail-Adresse",-1)),r(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.emailAddress=a),type:"email",id:"email",class:"form-control",required:""},null,512),[[m,s.value.emailAddress]])]),t("div",Ae,[e[22]||(e[22]=t("label",{for:"firstName",class:"form-label"},"Vorname",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.firstName=a),type:"text",id:"firstName",class:"form-control",required:""},null,512),[[m,s.value.firstName]])]),t("div",Ue,[e[23]||(e[23]=t("label",{for:"lastName",class:"form-label"},"Nachname",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.lastName=a),type:"text",id:"lastName",class:"form-control",required:""},null,512),[[m,s.value.lastName]])]),y.value.isAdmin?(n(),i("div",$e,[e[25]||(e[25]=t("label",{class:"form-label",for:"isAdmin"},"Admin",-1)),t("label",Me,[r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.isAdmin=a),type:"checkbox",id:"isAdmin"},null,512),[[ee,s.value.isAdmin]]),e[24]||(e[24]=t("span",{class:"slider round"},null,-1))])])):w("",!0),e[37]||(e[37]=t("h3",{class:"form-label"},"Passwort ändern",-1)),t("div",Be,[e[26]||(e[26]=t("input",{type:"text",style:{display:"none"},autocomplete:"username"},null,-1)),e[27]||(e[27]=t("label",{for:"newPassword",class:"form-label"},"Neues Passwort",-1)),t("div",Oe,[r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>p.value=a),type:c.value?"text":"password",id:"newPassword",class:"form-control",placeholder:"Neues Passwort",autocomplete:"off"},null,8,Ve),[[O,p.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[5]||(e[5]=a=>k(!0)),onMouseup:e[6]||(e[6]=a=>k(!1)),onMouseleave:e[7]||(e[7]=a=>k(!1))},[t("i",{class:V(c.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),e[28]||(e[28]=t("label",{for:"confirmPassword",class:"form-label"},"Passwort bestätigen",-1)),t("div",Se,[r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>f.value=a),type:c.value?"text":"password",id:"confirmPassword",class:"form-control",placeholder:"Passwort bestätigen",autocomplete:"off"},null,8,De),[[O,f.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[9]||(e[9]=a=>k(!0)),onMouseup:e[10]||(e[10]=a=>k(!1)),onMouseleave:e[11]||(e[11]=a=>k(!1))},[t("i",{class:V(c.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),$.value?(n(),i("p",ze,"Die Passwörter stimmen nicht überein.")):w("",!0)]),e[38]||(e[38]=t("h3",{class:"mt-4 form-label"},"Adressenangabe",-1)),t("div",Ee,[e[29]||(e[29]=t("label",{for:"street",class:"form-label"},"Straße*",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.address.street=a),type:"text",id:"street",class:"form-control"},null,512),[[m,s.value.address.street]]),e[30]||(e[30]=t("label",{for:"houseNumber",class:"form-label"},"Hausnummer*",-1)),r(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.address.houseNumber=a),type:"text",id:"houseNumber",class:"form-control"},null,512),[[m,s.value.address.houseNumber]]),e[31]||(e[31]=t("label",{for:"addressAddition",class:"form-label"},"Adresszusatz",-1)),r(t("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.address.addressAddition=a),type:"text",id:"addressAddition",class:"form-control"},null,512),[[m,s.value.address.addressAddition]]),e[32]||(e[32]=t("label",{for:"city",class:"form-label"},"Stadt*",-1)),r(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.address.city=a),type:"text",id:"city",class:"form-control"},null,512),[[m,s.value.address.city]]),e[33]||(e[33]=t("label",{for:"postalCode",class:"form-label"},"Postleitzahl*",-1)),r(t("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.address.postalCode=a),type:"text",id:"postalCode",class:"form-control"},null,512),[[m,s.value.address.postalCode]]),e[34]||(e[34]=t("label",{for:"country",class:"form-label"},"Land*",-1)),r(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>s.value.address.country=a),type:"text",id:"country",class:"form-control"},null,512),[[m,s.value.address.country]])]),t("div",Ie,[e[36]||(e[36]=t("h3",{class:"form-label"},"Zahlungsmethoden",-1)),s.value.payments.length>0?(n(),i("div",Fe,[(n(!0),i(te,null,se(s.value.payments,a=>(n(),i("div",{key:a.id,class:"payment-summary"},[t("strong",null,N(a.paymentOption),1),a.paymentOption==="bank transfer"?(n(),i("div",Ze,[t("p",null,"IBAN: "+N(j(a.iban)),1)])):a.paymentOption==="credit card"?(n(),i("div",Le,[t("p",null,"Nummer: "+N(J(a.creditCardNumber)),1),t("p",null,"Ablaufdatum: "+N(a.expiryDate||"n/a"),1)])):a.paymentOption==="paypal"?(n(),i("div",qe,[t("p",null,"E-Mail: "+N(K(a.paypalEmail)),1)])):w("",!0),t("button",{type:"button",onClick:T=>F(a),class:"btn btn-edit-payment"}," Bearbeiten ",8,Je),t("button",{type:"button",onClick:T=>Z(a.id),class:"btn btn-delete-payment"}," Löschen ",8,je)]))),128))])):(n(),i("div",Ke,e[35]||(e[35]=[t("p",null,"Keine Zahlungsmethoden hinterlegt.",-1)]))),t("button",{type:"button",class:"btn btn-secondary",onClick:L}," Zahlungsmethode hinzufügen ")]),e[39]||(e[39]=t("hr",{class:"section-divider"},null,-1)),t("div",Te,[t("button",{type:"submit",class:"btn save-btn",disabled:!u.value},"Speichern",8,Re),y.value.isAdmin?(n(),i("button",{key:0,type:"button",onClick:e[18]||(e[18]=a=>E(s.value.id)),class:"btn btn-danger"}," Löschen ")):w("",!0)])],32)])),b.value?(n(),D(we,{key:2,show:b.value,payment:g.value,userId:s.value.id,onClose:B,onSave:q},null,8,["show","payment","userId"])):w("",!0)]))}},Qe=S(Ye,[["__scopeId","data-v-34fe03f7"]]);export{Qe as default};
