import{_ as M,r as h,y as U,k as b,l as q,c as r,a as i,f as J,e as _,F as z,m as A,t as f,p as k,q as p,o as l,n as E,b as P,v as T}from"./index-CZW32xBW.js";import{B as j}from"./BackButton-BnD-fthU.js";const G={class:"edit-category"},H={class:"back-button-wrapper"},R={key:0,class:"text-center"},W={key:1},Z={class:"table-wrapper"},Q={class:"table"},X=["onDblclick"],Y=["onUpdate:modelValue","onInput","onBlur"],ee={key:1},te=["onUpdate:modelValue","onInput","onBlur"],ne={key:1},ie={class:"actions-column"},se=["onClick"],ae={class:"pagination"},oe=["disabled"],re=["disabled"],le={class:"actions"},de=["disabled"],x=10,ce={__name:"EditCategory",setup(ue){const d=h([]),u=h([]),g=h({}),o=U([]),c=h(1),w=h(!0),C=async()=>{var t,n;try{const{data:e}=await k.get("/api/category");d.value=e,u.value=JSON.parse(JSON.stringify(e))}catch(e){console.error("Fehler beim Laden der Kategorien:",e),await p.fire({title:"Fehler beim Laden der Kategorien!",text:((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}finally{w.value=!1}},D=async t=>{var e,s;if((await p.fire({title:"Kategorie löschen?",text:"Möchten Sie diesen Kategorie wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await k.delete(`/api/category/${t}`),d.value=d.value.filter(a=>a.id!==t),u.value=u.value.filter(a=>a.id!==t),await p.fire({title:"Gelöscht",text:"Die ausgewählte Kategorie wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"})}catch(a){console.error("Fehler beim Löschen der Kategorie:",a),await p.fire({title:"Fehler beim Löschen der Kategorie!",text:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},V=b(()=>{const t=(c.value-1)*x;return d.value.slice(t,t+x)}),v=b(()=>Math.ceil(d.value.length/x)),$=b(()=>o.some(t=>!t.name.trim()||!t.type.trim())),L=()=>{c.value>1&&c.value--},O=()=>{c.value<v.value&&c.value++},S=t=>{g.value[t]=!0},y=t=>{g.value[t]&&(g.value[t]=!1,F(t))},B=t=>!!g.value[t],K=(t,n)=>{const e=d.value.find(s=>s.id===t);if(e){const s=u.value.find(a=>a.id===t);s&&e[n]!==s[n]&&F(t)}},F=t=>{const n=d.value.find(s=>s.id===t),e=u.value.find(s=>s.id===t);if(n&&e){if(!n.name.trim()||!n.type.trim()){const a=o.findIndex(m=>m.id===t);a>=0&&o.splice(a,1);return}if(Object.keys(e).some(a=>n[a]!==e[a])){const a=o.findIndex(m=>m.id===t);a>=0?o[a]={...n}:o.push({...n})}else{const a=o.findIndex(m=>m.id===t);a>=0&&o.splice(a,1)}}},I=(t,n)=>{const e=d.value.find(a=>a.id===t),s=u.value.find(a=>a.id===t);return e&&s&&e[n]!==s[n]},N=async()=>{var t,n;try{await Promise.all(o.map(e=>k.patch(`/api/category/${e.id}`,{name:e.name,type:e.type}))),o.length=0,await p.fire({title:"Kategorie(n) wurden erfolgreich geupdated!",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),await C()}catch(e){console.error("Fehler beim updaten der Änderungen:",e),await p.fire({title:"Fehler beim updaten der Änderungen!",text:((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}};return q(C),(t,n)=>(l(),r("div",G,[i("div",H,[J(j,{class:"back-button"})]),n[2]||(n[2]=i("h2",{class:"page-title"},"Kategorien bearbeiten",-1)),n[3]||(n[3]=i("p",{class:"info-text"},[_(" Hinweis: Sie können Felder per "),i("strong",null,"Doppelklick"),_(" bearbeiten. Änderungen werden gesammelt und mit einem einzigen Klick geupdated! Änderungen werden "),i("strong",null,"Rot"),_(" markiert. ")],-1)),w.value?(l(),r("div",R,n[0]||(n[0]=[i("p",null,"Lade Kategorien...",-1)]))):(l(),r("div",W,[i("div",Z,[i("table",Q,[n[1]||(n[1]=i("thead",null,[i("tr",null,[i("th",null,"ID"),i("th",null,"Name"),i("th",null,"Typ"),i("th",null,"Aktion")])],-1)),i("tbody",null,[(l(!0),r(z,null,A(V.value,e=>(l(),r("tr",{key:e.id,onDblclick:s=>S(e.id)},[i("td",null,f(e.id),1),i("td",{class:E([{"modified-field":I(e.id,"name")},{"empty-field":!e.name.trim()}])},[B(e.id)?P((l(),r("input",{key:0,"onUpdate:modelValue":s=>e.name=s,onInput:s=>K(e.id,"name"),onBlur:s=>y(e.id),class:"edit-input",maxlength:"10",required:""},null,40,Y)),[[T,e.name]]):(l(),r("span",ee,f(e.name),1))],2),i("td",{class:E([{"modified-field":I(e.id,"type")},{"empty-field":!e.type.trim()}])},[B(e.id)?P((l(),r("input",{key:0,"onUpdate:modelValue":s=>e.type=s,onInput:s=>K(e.id,"type"),onBlur:s=>y(e.id),class:"edit-input",maxlength:"10",required:""},null,40,te)),[[T,e.type]]):(l(),r("span",ne,f(e.type),1))],2),i("td",ie,[i("button",{onClick:s=>D(e.id),class:"btn btn-secondary"}," Löschen ",8,se)])],40,X))),128))])])]),i("div",ae,[i("button",{onClick:L,disabled:c.value===1},"Zurück",8,oe),i("span",null,"Seite "+f(c.value)+" von "+f(v.value),1),i("button",{onClick:O,disabled:c.value===v.value},"Weiter",8,re)]),i("div",le,[i("button",{onClick:N,class:"btn btn-primary",disabled:o.length===0||$.value}," Änderungen speichern ",8,de)])]))]))}},he=M(ce,[["__scopeId","data-v-813f38fc"]]);export{he as default};
