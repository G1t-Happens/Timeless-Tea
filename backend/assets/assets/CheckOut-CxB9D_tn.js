import{_ as I,o as i,C as T,g as x,c as d,a as e,F as V,m as S,t as n,e as v,d as N,w as G,T as Q,G as H,u as L,r as c,k as j,l as W,f as k,i as C,b as m,v as p,x as J,p as $,q as P,h as X,n as Y,s as _}from"./index-DCsXwHbn.js";import{B as ee}from"./BackButton-B2a4y3iK.js";const te={class:"modal-container"},se={class:"order-summary"},ne={class:"summary-table"},le={class:"summary-total"},ie={class:"user-info"},de={class:"payment-info"},ae={key:0},oe={key:0},re={key:1},ue={key:2},me={key:1},pe={class:"shipping-info"},ye={key:0},ve={key:1},be={key:0},fe={key:1},he={__name:"OrderConfirmationModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0},cartItems:{type:Array,required:!0},totalAmount:{type:Number,required:!0},payment:{type:Object,required:!1},useBillingAsShipping:{type:Boolean,required:!0},shippingAddress:{type:Object,required:!0}},emits:["close","confirm"],setup(l,{emit:b}){const A=b,B=()=>A("close"),h=()=>A("confirm");return(g,a)=>(i(),T(Q,{name:"fade-modal"},{default:x(()=>[l.show?(i(),d("div",{key:0,class:"modal-backdrop",onClick:G(B,["self"])},[e("div",te,[a[8]||(a[8]=e("h2",null,"Bestellzusammenfassung",-1)),e("div",se,[a[1]||(a[1]=e("h3",null,"Produkte",-1)),e("table",ne,[a[0]||(a[0]=e("thead",null,[e("tr",null,[e("th",null,"Produkt"),e("th",null,"Artikel"),e("th",null,"Preis (€)"),e("th",null,"Gesamt (€)")])],-1)),e("tbody",null,[(i(!0),d(V,null,S(l.cartItems,y=>(i(),d("tr",{key:y.id},[e("td",null,n(y.name),1),e("td",null,n(y.productQuantity),1),e("td",null,n(y.price.toFixed(2)),1),e("td",null,n((y.price*y.productQuantity).toFixed(2)),1)]))),128))])]),e("div",le,[e("strong",null,"Gesamtsumme: "+n(l.totalAmount.toFixed(2))+" €",1)])]),e("div",ie,[a[2]||(a[2]=e("h3",null,"Rechnungsadresse",-1)),e("p",null,n(l.user.firstName)+" "+n(l.user.lastName),1),e("p",null,n(l.user.emailAddress),1),e("p",null,n(l.user.address.street)+" "+n(l.user.address.houseNumber)+", "+n(l.user.address.postalCode)+" "+n(l.user.address.city)+", "+n(l.user.address.country),1)]),e("div",de,[a[5]||(a[5]=e("h3",null,"Zahlungsmethode",-1)),l.payment&&l.payment.paymentOption?(i(),d("p",ae,[v(" Option: "+n(l.payment.paymentOption),1),a[4]||(a[4]=e("br",null,null,-1)),l.payment.paymentOption==="bank transfer"?(i(),d("span",oe," IBAN: "+n(l.payment.iban),1)):l.payment.paymentOption==="credit card"?(i(),d("span",re,[v(" Kreditkartennummer: **** **** **** "+n(l.payment.creditCardNumber.slice(-4)),1),a[3]||(a[3]=e("br",null,null,-1)),v(" Ablaufdatum: "+n(l.payment.expiryDate||"n/a"),1)])):l.payment.paymentOption==="paypal"?(i(),d("span",ue," PayPal E-Mail: "+n(l.payment.paypalEmail),1)):N("",!0)])):(i(),d("p",me,"Keine Zahlungsmethode hinterlegt."))]),e("div",pe,[a[7]||(a[7]=e("h3",null,"Versandinformationen",-1)),l.useBillingAsShipping?(i(),d("div",ye,a[6]||(a[6]=[e("p",null,"Die Versandadresse entspricht der Rechnungsadresse.",-1)]))):(i(),d("div",ve,[e("p",null,n(l.shippingAddress.street)+" "+n(l.shippingAddress.houseNumber)+", "+n(l.shippingAddress.postalCode)+" "+n(l.shippingAddress.city)+", "+n(l.shippingAddress.country),1),l.shippingAddress.addressAddition?(i(),d("p",be," Zusatz: "+n(l.shippingAddress.addressAddition),1)):N("",!0),l.shippingAddress.state?(i(),d("p",fe,"Bundesland: "+n(l.shippingAddress.state),1)):N("",!0)]))]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-success",onClick:h},"Bestellung bestätigen"),e("button",{class:"btn btn-danger",onClick:B},"Abbrechen")])])])):N("",!0)]),_:1}))}},ge=I(he,[["__scopeId","data-v-b2750310"]]),ce={class:"checkout"},ke={key:0,class:"empty-cart"},Ae={key:1,class:"checkout-container"},Ce={class:"order-summary"},xe={class:"summary-table"},Ne={class:"summary-total"},Be={class:"user-details"},Oe={class:"edit-hint"},Ve={class:"detail-item"},Se={class:"detail-item"},Ue={class:"detail-item"},we={class:"detail-item"},$e={class:"detail-item"},Pe={class:"detail-item"},Ie={class:"detail-item"},Fe={class:"detail-item"},Ee={class:"payment-method"},Me={class:"edit-hint"},qe={key:0,class:"payment-list-container"},ze=["onClick"],De={class:"payment-option"},Ze={key:0},Re={key:1},Ke={key:2},Te={key:1},Ge={class:"shipping-info"},Qe={class:"checkbox-wrapper"},He={key:0},Le={key:1},je={class:"detail-item"},We={class:"detail-item"},Je={class:"detail-item"},Xe={class:"detail-item"},Ye={class:"detail-item"},_e={class:"detail-item"},et={class:"detail-item"},tt={class:"checkout-actions"},st=["disabled"],nt={__name:"CheckOut",setup(l){const b=H(),A=L(),B=_(),h=c([]),g=c(null),a=c(!1),y=c(!0),u=c({}),r=c({id:null,emailAddress:"",firstName:"",lastName:"",address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payment:{paymentOption:null,iban:null,creditCardNumber:null,expiryDate:null,cvc:null,paypalEmail:null}}),U=j(()=>b.items.length>0&&A.user&&r.value.address&&g.value),F=()=>h.value.find(o=>o.id===g.value)||null,E=async()=>{try{const o=await $.get(`/api/user/${A.user.id}`);r.value=o.data,h.value=o.data.payments.filter(t=>!t.isForOrder)}catch(o){console.error("Fehler beim Laden des Benutzers oder der Zahlungsdaten:",o)}},M=o=>o?"**** **** **** "+o.slice(-4):"n/a",q=o=>{if(!o)return"n/a";const t=o.replace(/\s/g,"");return t.slice(0,4)+" **** **** "+t.slice(-2)},z=o=>{if(!o)return"n/a";const[t,f]=o.split("@");return t[0]+"****@"+f},D=o=>{g.value=o},Z=()=>{a.value=!0},w=()=>{a.value=!1},R=async()=>{w(),await K()},K=async()=>{var o,t;if(!U.value){await P.fire({title:"Erforderliche Informationen fehlen",text:"Bitte stellen Sie sicher, dass alle erforderlichen Informationen ausgefüllt sind.",icon:"warning",confirmButtonText:"OK"});return}try{const f={totalAmount:parseFloat(b.totalAmount),payment:g.value,orderProducts:b.items.map(O=>({product:O.id,quantity:O.productQuantity})),newShippingAddress:y.value?null:{...u.value}},s=await $.post("/api/order",f);b.clearCart(),await B.push({name:"OrderSuccess",query:{id:s.data.id}})}catch(f){console.error("Fehler beim Abschicken der Bestellung:",f),await P.fire({title:"Fehler beim Abschicken der Bestellung!",text:((t=(o=f.response)==null?void 0:o.data)==null?void 0:t.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}};return W(async()=>{await E()}),(o,t)=>{const f=X("router-link");return i(),d("div",ce,[t[50]||(t[50]=e("h1",{class:"checkout-title"},"Checkout",-1)),k(ee),C(b).items.length===0?(i(),d("div",ke,[t[17]||(t[17]=e("p",null,"Ihr Warenkorb ist leer.",-1)),k(f,{to:"/",class:"btn btn-primary"},{default:x(()=>t[16]||(t[16]=[v("Zurück zum Shop")])),_:1})])):(i(),d("div",Ae,[e("div",Ce,[t[19]||(t[19]=e("h2",null,"Bestellübersicht",-1)),e("table",xe,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",null,"Produkt"),e("th",null,"Artikel"),e("th",null,"Preis (€)"),e("th",null,"Gesamt (€)")])],-1)),e("tbody",null,[(i(!0),d(V,null,S(C(b).items,s=>(i(),d("tr",{key:s.id},[e("td",null,n(s.name),1),e("td",null,n(s.productQuantity),1),e("td",null,n(s.price.toFixed(2)),1),e("td",null,n((s.price*s.productQuantity).toFixed(2)),1)]))),128))])]),e("div",Ne,[e("strong",null,"Gesamtsumme: "+n(C(b).totalAmount)+" €",1)])]),e("div",Be,[t[32]||(t[32]=e("h2",null,"Rechnungsadresse",-1)),e("p",Oe,[t[21]||(t[21]=e("strong",null,"Hinweis:",-1)),t[22]||(t[22]=v(" Falls Sie Ihre Rechnungsadresse ändern möchten, können Sie das ")),k(f,{to:{name:"UserEditUser"}},{default:x(()=>t[20]||(t[20]=[v("hier")])),_:1}),t[23]||(t[23]=v(" erledigen. "))]),e("div",Ve,[t[24]||(t[24]=e("label",{for:"firstName"},"Vorname:",-1)),m(e("input",{id:"firstName",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>r.value.firstName=s),disabled:""},null,512),[[p,r.value.firstName]])]),e("div",Se,[t[25]||(t[25]=e("label",{for:"lastName"},"Nachname:",-1)),m(e("input",{id:"lastName",type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>r.value.lastName=s),disabled:""},null,512),[[p,r.value.lastName]])]),e("div",Ue,[t[26]||(t[26]=e("label",{for:"email"},"E-Mail:",-1)),m(e("input",{id:"email",type:"email","onUpdate:modelValue":t[2]||(t[2]=s=>r.value.emailAddress=s),disabled:""},null,512),[[p,r.value.emailAddress]])]),e("div",we,[t[27]||(t[27]=e("label",{for:"country"},"Land:",-1)),m(e("input",{id:"country",type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>r.value.address.country=s),disabled:""},null,512),[[p,r.value.address.country]])]),e("div",$e,[t[28]||(t[28]=e("label",{for:"postalCode"},"Postleitzahl:",-1)),m(e("input",{id:"postalCode",type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>r.value.address.postalCode=s),disabled:""},null,512),[[p,r.value.address.postalCode]])]),e("div",Pe,[t[29]||(t[29]=e("label",{for:"city"},"Stadt:",-1)),m(e("input",{id:"city",type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>r.value.address.city=s),disabled:""},null,512),[[p,r.value.address.city]])]),e("div",Ie,[t[30]||(t[30]=e("label",{for:"street"},"Straße:",-1)),m(e("input",{id:"street",type:"text","onUpdate:modelValue":t[6]||(t[6]=s=>r.value.address.street=s),disabled:""},null,512),[[p,r.value.address.street]])]),e("div",Fe,[t[31]||(t[31]=e("label",{for:"houseNumber"},"Hausnummer:",-1)),m(e("input",{id:"houseNumber",type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>r.value.address.houseNumber=s),disabled:""},null,512),[[p,r.value.address.houseNumber]])])]),e("div",Ee,[t[39]||(t[39]=e("h2",null,"Zahlungsmethode",-1)),e("p",Me,[t[34]||(t[34]=e("strong",null,"Hinweis:",-1)),t[35]||(t[35]=v(" Wählen Sie eine der hinterlegten Zahlungsmethoden aus oder ")),k(f,{to:{name:"UserEditUser"}},{default:x(()=>t[33]||(t[33]=[v("fügen Sie eine neue hinzu.")])),_:1})]),h.value.length>0?(i(),d("div",qe,[(i(!0),d(V,null,S(h.value,s=>(i(),d("div",{key:s.id,class:Y(["payment-panel",{active:g.value===s.id}]),onClick:O=>D(s.id)},[e("p",De,"Option: "+n(s.paymentOption),1),s.paymentOption==="bank transfer"?(i(),d("div",Ze,[e("p",null,"IBAN: "+n(q(s.iban)),1)])):s.paymentOption==="credit card"?(i(),d("div",Re,[e("p",null,"Kreditkartennummer: "+n(M(s.creditCardNumber)),1),e("p",null,"Ablaufdatum: "+n(s.expiryDate||"n/a"),1)])):s.paymentOption==="paypal"?(i(),d("div",Ke,[e("p",null,"PayPal E-Mail: "+n(z(s.paypalEmail)),1)])):N("",!0)],10,ze))),128))])):(i(),d("div",Te,[e("p",null,[t[37]||(t[37]=v(" Keine Zahlungsmethode hinterlegt. Bitte ")),k(f,{to:{name:"UserEditUser"}},{default:x(()=>t[36]||(t[36]=[v(" hinterlegen Sie Ihre Zahlungsdaten! ")])),_:1}),t[38]||(t[38]=v(" . "))])]))]),e("div",Ge,[t[49]||(t[49]=e("h2",null,"Versandinformationen",-1)),e("div",Qe,[m(e("input",{type:"checkbox",id:"use-billing-as-shipping","onUpdate:modelValue":t[8]||(t[8]=s=>y.value=s)},null,512),[[J,y.value]]),t[40]||(t[40]=e("label",{for:"use-billing-as-shipping"}," Versandadresse ist identisch mit der Rechnungsadresse ",-1))]),y.value?(i(),d("div",He,t[41]||(t[41]=[e("p",null,"Die Versandadresse entspricht der oben angegebenen Rechnungsadresse.",-1)]))):(i(),d("div",Le,[e("div",je,[t[42]||(t[42]=e("label",{for:"ship-country"},"Land*:",-1)),m(e("input",{id:"ship-country",type:"text","onUpdate:modelValue":t[9]||(t[9]=s=>u.value.country=s)},null,512),[[p,u.value.country]])]),e("div",We,[t[43]||(t[43]=e("label",{for:"ship-postal-code"},"Postleitzahl*:",-1)),m(e("input",{id:"ship-postal-code",type:"text","onUpdate:modelValue":t[10]||(t[10]=s=>u.value.postalCode=s)},null,512),[[p,u.value.postalCode]])]),e("div",Je,[t[44]||(t[44]=e("label",{for:"ship-city"},"Stadt*:",-1)),m(e("input",{id:"ship-city",type:"text","onUpdate:modelValue":t[11]||(t[11]=s=>u.value.city=s)},null,512),[[p,u.value.city]])]),e("div",Xe,[t[45]||(t[45]=e("label",{for:"ship-street"},"Straße*:",-1)),m(e("input",{id:"ship-street",type:"text","onUpdate:modelValue":t[12]||(t[12]=s=>u.value.street=s)},null,512),[[p,u.value.street]])]),e("div",Ye,[t[46]||(t[46]=e("label",{for:"ship-house-number"},"Hausnummer*:",-1)),m(e("input",{id:"ship-house-number",type:"text","onUpdate:modelValue":t[13]||(t[13]=s=>u.value.houseNumber=s)},null,512),[[p,u.value.houseNumber]])]),e("div",_e,[t[47]||(t[47]=e("label",{for:"ship-addition"},"Adresszusatz (optional):",-1)),m(e("input",{id:"ship-addition",type:"text","onUpdate:modelValue":t[14]||(t[14]=s=>u.value.addressAddition=s)},null,512),[[p,u.value.addressAddition]])]),e("div",et,[t[48]||(t[48]=e("label",{for:"ship-state"},"Bundesland (optional):",-1)),m(e("input",{id:"ship-state",type:"text","onUpdate:modelValue":t[15]||(t[15]=s=>u.value.state=s)},null,512),[[p,u.value.state]])])]))]),e("div",tt,[e("button",{onClick:Z,class:"btn btn-success",disabled:!U.value}," Bestellung abschicken ",8,st)])])),k(ge,{show:a.value,user:r.value,cartItems:C(b).items,totalAmount:Number(C(b).totalAmount),payment:F(),useBillingAsShipping:y.value,shippingAddress:u.value,onClose:w,onConfirm:R},null,8,["show","user","cartItems","totalAmount","payment","useBillingAsShipping","shippingAddress"])])}}},dt=I(nt,[["__scopeId","data-v-7dcdd8db"]]);export{dt as default};
