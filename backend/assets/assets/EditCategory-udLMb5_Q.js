import{_ as N,r as h,y as M,k as E,l as U,c as o,a as i,f as J,e as b,F as z,m as A,t as g,p as _,q as p,o as l,n as I,b as P,v as T}from"./index-DCsXwHbn.js";import{B as j}from"./BackButton-B2a4y3iK.js";const q={class:"edit-category"},G={class:"back-button-wrapper"},H={key:0,class:"text-center"},R={key:1},W={class:"table-wrapper"},Z={class:"table"},Q=["onDblclick"],X=["onUpdate:modelValue","onInput","onBlur"],Y={key:1},ee=["onUpdate:modelValue","onInput","onBlur"],te={key:1},ne={class:"actions-column"},ie=["onClick"],se={class:"pagination"},ae=["disabled"],oe=["disabled"],le={class:"actions"},re=["disabled"],k=10,de={__name:"EditCategory",setup(ce){const r=h([]),u=h([]),f=h({}),d=M([]),c=h(1),w=h(!0),x=async()=>{var t,n;try{const{data:e}=await _.get("/api/category");r.value=e,u.value=JSON.parse(JSON.stringify(e))}catch(e){console.error("Fehler beim Laden der Kategorien:",e),await p.fire({title:"Fehler beim Laden der Kategorien!",text:((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}finally{w.value=!1}},D=async t=>{var e,s;if((await p.fire({title:"Kategorie löschen?",text:"Möchten Sie diesen Kategorie wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await _.delete(`/api/category/${t}`),r.value=r.value.filter(a=>a.id!==t),u.value=u.value.filter(a=>a.id!==t),await p.fire({title:"Gelöscht",text:"Die ausgewählte Kategorie wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"})}catch(a){console.error("Fehler beim Löschen der Kategorie:",a),await p.fire({title:"Fehler beim Löschen der Kategorie!",text:((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},V=E(()=>{const t=(c.value-1)*k;return r.value.slice(t,t+k)}),v=E(()=>Math.ceil(r.value.length/k)),$=()=>{c.value>1&&c.value--},L=()=>{c.value<v.value&&c.value++},O=t=>{f.value[t]=!0},C=t=>{f.value[t]&&(f.value[t]=!1,K(t))},B=t=>!!f.value[t],y=(t,n)=>{const e=r.value.find(s=>s.id===t);if(e){const s=u.value.find(a=>a.id===t);s&&e[n]!==s[n]&&K(t)}},K=t=>{const n=r.value.find(s=>s.id===t),e=u.value.find(s=>s.id===t);if(n&&e)if(Object.keys(e).some(a=>n[a]!==e[a])){const a=d.findIndex(m=>m.id===t);a>=0?d[a]={...n}:d.push({...n})}else{const a=d.findIndex(m=>m.id===t);a>=0&&d.splice(a,1)}},F=(t,n)=>{const e=r.value.find(a=>a.id===t),s=u.value.find(a=>a.id===t);return e&&s&&e[n]!==s[n]},S=async()=>{var t,n;try{await Promise.all(d.map(e=>_.patch(`/api/category/${e.id}`,{name:e.name,type:e.type}))),d.length=0,await p.fire({title:"Kategorie(n) wurden erfolgreich geupdated!",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),await x()}catch(e){console.error("Fehler beim updaten der Änderungen:",e),await p.fire({title:"Fehler beim updaten der Änderungen!",text:((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}};return U(x),(t,n)=>(l(),o("div",q,[i("div",G,[J(j,{class:"back-button"})]),n[2]||(n[2]=i("h2",{class:"page-title"},"Kategorien bearbeiten",-1)),n[3]||(n[3]=i("p",{class:"info-text"},[b(" Hinweis: Sie können Felder per "),i("strong",null,"Doppelklick"),b(" bearbeiten. Änderungen werden gesammelt und mit einem einzigen Klick geupdated! Änderungen werden "),i("strong",null,"Rot"),b(" markiert. ")],-1)),w.value?(l(),o("div",H,n[0]||(n[0]=[i("p",null,"Lade Kategorien...",-1)]))):(l(),o("div",R,[i("div",W,[i("table",Z,[n[1]||(n[1]=i("thead",null,[i("tr",null,[i("th",null,"ID"),i("th",null,"Name"),i("th",null,"Typ"),i("th",null,"Aktion")])],-1)),i("tbody",null,[(l(!0),o(z,null,A(V.value,e=>(l(),o("tr",{key:e.id,onDblclick:s=>O(e.id)},[i("td",null,g(e.id),1),i("td",{class:I({"modified-field":F(e.id,"name")})},[B(e.id)?P((l(),o("input",{key:0,"onUpdate:modelValue":s=>e.name=s,onInput:s=>y(e.id,"name"),onBlur:s=>C(e.id),class:"edit-input"},null,40,X)),[[T,e.name]]):(l(),o("span",Y,g(e.name),1))],2),i("td",{class:I({"modified-field":F(e.id,"type")})},[B(e.id)?P((l(),o("input",{key:0,"onUpdate:modelValue":s=>e.type=s,onInput:s=>y(e.id,"type"),onBlur:s=>C(e.id),class:"edit-input"},null,40,ee)),[[T,e.type]]):(l(),o("span",te,g(e.type),1))],2),i("td",ne,[i("button",{onClick:s=>D(e.id),class:"btn delete-btn"},"Löschen",8,ie)])],40,Q))),128))])])]),i("div",se,[i("button",{onClick:$,disabled:c.value===1},"Zurück",8,ae),i("span",null,"Seite "+g(c.value)+" von "+g(v.value),1),i("button",{onClick:L,disabled:c.value===v.value},"Weiter",8,oe)]),i("div",le,[i("button",{onClick:S,class:"btn btn-primary",disabled:d.length===0}," Änderungen speichern ",8,re)])]))]))}},he=N(de,[["__scopeId","data-v-b958cb52"]]);export{he as default};
