import{_ as j,r as d,l as G,z as Z,p as y,q as p,k as J,c as s,f as Q,a as r,b as f,x as C,d as c,n as b,v as k,t as m,F as M,m as N,e as V,w as H,A as W,o,s as X}from"./index-DAGLbK9s.js";import{B as Y}from"./BackButton-wpOQ6MoJ.js";const ee={class:"edit-article"},te={key:0,class:"text-center"},ne={key:1},ae={key:0,class:"form-group toggle-switch"},re={class:"switch","aria-labelledby":"isDeleted"},ie={key:1,class:"image-preview"},le=["src"],se={key:0,class:"error"},oe={key:0,class:"error"},ue={key:0,class:"error"},de={key:0,class:"error"},ce={class:"form-group"},pe=["value"],me={key:1,class:"selected-options"},ve={class:"form-group"},fe={class:"button-group"},ge=["disabled"],be={__name:"EditArticle",setup(he){const E=W(),q=X(),w=d(!0),v=d([]),x=d([]),g=d(null),B=d(null),D=d(null),h=d(null),a=d({id:null,name:"",description:"",price:0,quantity:0,categories:[],image:null,isDeleted:!1}),i=d({name:"",description:"",price:"",quantity:""}),L=n=>{const e=n.reduce((t,l)=>{const u=l.type||"Andere";return t[u]=t[u]||[],t[u].push(l),t},{});return Object.entries(e).map(([t,l])=>({type:t,categories:l}))},T=()=>v.value.map(n=>{var e;return(e=x.value.flatMap(t=>t.categories).find(t=>t.id===n))==null?void 0:e.name});G(async()=>{await _(),await z(E.params.id),h.value=a.value.image,document.addEventListener("click",A)}),Z(()=>{document.removeEventListener("click",A)});const P=n=>{g.value===n?g.value=null:g.value=n},A=n=>{const e=B.value&&B.value.contains(n.target),t=D.value&&D.value.contains(n.target);!e&&!t&&(g.value=null)},_=async()=>{var n,e;try{const{data:t}=await y.get("/api/category");x.value=L(t)}catch(t){console.error("Fehler beim Laden der Kategorien:",t),await p.fire({title:"Fehler beim Laden der Kategorien!",text:((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},z=async n=>{var e,t;w.value=!0;try{const{data:l}=await y.get(`/api/product/${n}`);l.isDeleted=!!l.isDeleted,a.value=l,v.value=l.productCategories.map(u=>u.id)}catch(l){console.error("Fehler beim Laden des Artikels:",l),await p.fire({title:"Fehler beim Laden des Artikel!",text:((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}finally{w.value=!1}};function R(){a.value.name.trim()?a.value.name.trim().length>30?i.value.name="Der Name darf max. 30 Zeichen lang sein":i.value.name="":i.value.name="Bitte einen Artikelnamen eingeben"}function S(){a.value.description.trim().length>512?i.value.description="Die Beschreibung darf max. 512 Zeichen lang sein.":i.value.description=""}function U(){const n=a.value.price;if(!n){i.value.price="Bitte einen Preis eingeben.";return}if(!/^\d+(\.\d{1,2})?$/.test(n)){i.value.price="Preis darf max. zwei Nachkommastellen haben.";return}const t=parseFloat(n);if(t<0||t>1e3){i.value.price="Preis muss zwischen 0 und 1000 liegen.";return}i.value.price=""}function K(){const n=a.value.quantity;if(n==null||n===""){i.value.quantity="Bitte eine Menge eingeben";return}if(isNaN(n)){i.value.quantity="Bitte eine gültige Menge eingeben";return}if(!Number.isInteger(n)){i.value.quantity="Bitte nur ganze Zahlen eingeben";return}if(n<0){i.value.quantity="Die Menge darf nicht negativ sein";return}if(n>1e5){i.value.quantity="Die Menge darf nicht mehr als 100000 sein";return}i.value.quantity=""}const F=J(()=>{const n=!!a.value.name.trim(),e=!!a.value.price,t=!!a.value.quantity;return!(i.value.name||i.value.description||i.value.price||i.value.quantity)&&n&&e&&t}),O=async()=>{var e,t;const n=new FormData;n.append("name",a.value.name),n.append("description",a.value.description),n.append("price",a.value.price),n.append("quantity",a.value.quantity),n.append("isDeleted",a.value.isDeleted),n.append("categories",JSON.stringify(v.value)),a.value.image instanceof File&&n.append("image",a.value.image);try{await y.patch(`/api/product/${a.value.id}`,n),await p.fire({title:"Artikel geupdated!",text:`Artikel: "${a.value.name}" wurde erfolgreich geupdated.`,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),await q.push({name:"AdminDashboard"})}catch(l){console.error("Fehler beim Speichern des Artikels:",l),await p.fire({title:"Fehler beim Speichern des Artikels!",text:((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},I=async n=>{var t,l;if((await p.fire({title:"Produkt entfernen?",text:"Möchten Sie dieses Produkt wirklich entfernen? Dieser Vorgang kann im nachhinein über die Produkte Bearbeitungsseite rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, entfernen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await y.delete(`/api/product/${n}`),await p.fire({title:"Gelöscht",text:"Der User wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}),await q.push({name:"AdminDashboard"})}catch(u){console.error("Fehler beim Löschen des Artikels:",u),await p.fire({title:"Fehler beim Löschen des Artikels!",text:((l=(t=u.response)==null?void 0:t.data)==null?void 0:l.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},$=n=>{const e=n.target.files;e&&e[0]&&(a.value.image=e[0],h.value=URL.createObjectURL(e[0]))};return(n,e)=>(o(),s("div",ee,[Q(Y),e[18]||(e[18]=r("h2",{class:"page-title"},"Artikel bearbeiten",-1)),w.value?(o(),s("div",te,e[8]||(e[8]=[r("p",null,"Lade Artikel...",-1)]))):(o(),s("div",ne,[r("form",{onSubmit:H(O,["prevent"]),class:"form-container",method:"post",enctype:"multipart/form-data"},[a.value.id?(o(),s("div",ae,[e[10]||(e[10]=r("label",{class:"form-label",for:"isDeleted"},"Als gelöscht markieren",-1)),r("label",re,[f(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.isDeleted=t),type:"checkbox",id:"isDeleted"},null,512),[[C,a.value.isDeleted]]),e[9]||(e[9]=r("span",{class:"slider round"},null,-1))])])):c("",!0),h.value?(o(),s("div",ie,[r("img",{src:h.value,alt:"Vorschau des hochgeladenen Bildes",class:"preview-image"},null,8,le)])):c("",!0),r("div",{class:b(["form-group",{"has-error":i.value.name}])},[e[11]||(e[11]=r("label",{for:"name",class:"form-label"},"Artikelname",-1)),f(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.name=t),type:"text",id:"name",class:"form-control",placeholder:"z.B. Sencha Green Tea",onInput:R,maxlength:"30",required:""},null,544),[[k,a.value.name]]),i.value.name?(o(),s("span",se,m(i.value.name),1)):c("",!0)],2),r("div",{class:b(["form-group",{"has-error":i.value.description}])},[e[12]||(e[12]=r("label",{for:"description",class:"form-label"},"Beschreibung",-1)),f(r("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>a.value.description=t),id:"description",class:"form-control",placeholder:"z.B. Dieser Tee...",onInput:S,maxlength:"512"},null,544),[[k,a.value.description]]),i.value.description?(o(),s("span",oe,m(i.value.description),1)):c("",!0)],2),r("div",{class:b(["form-group",{"has-error":i.value.price}])},[e[13]||(e[13]=r("label",{for:"price",class:"form-label"},"Preis in €",-1)),f(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.price=t),type:"number",step:"0.01",id:"price",class:"form-control",placeholder:"z.B. 12.99",onInput:U,min:"0",max:"1000",required:""},null,544),[[k,a.value.price]]),i.value.price?(o(),s("span",ue,m(i.value.price),1)):c("",!0)],2),r("div",{class:b(["form-group",{"has-error":i.value.quantity}])},[e[14]||(e[14]=r("label",{for:"price",class:"form-label"},"Menge in g (Gram)",-1)),f(r("input",{type:"number",step:"1","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.quantity=t),id:"quantity",class:"form-control",onInput:K,min:"1",max:"100000",required:""},null,544),[[k,a.value.quantity]]),i.value.quantity?(o(),s("span",de,m(i.value.quantity),1)):c("",!0)],2),r("div",ce,[e[16]||(e[16]=r("label",{for:"categories",class:"form-label"},"Kategorien",-1)),r("button",{class:"dropdown-button",type:"button",onClick:e[5]||(e[5]=t=>P("categories")),ref_key:"dropdownButtonRef",ref:B}," ▾ Kategorien wählen ",512),g.value==="categories"?(o(),s("div",{key:0,class:"dropdown-menu",ref_key:"dropdownMenuRef",ref:D},[(o(!0),s(M,null,N(x.value,t=>(o(),s("div",{key:t.type},[r("strong",null,m(t.type),1),(o(!0),s(M,null,N(t.categories,l=>(o(),s("div",{key:l.id},[r("label",null,[f(r("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=u=>v.value=u),value:l.id},null,8,pe),[[C,v.value]]),V(" "+m(l.name),1)])]))),128))]))),128))],512)):c("",!0),v.value.length?(o(),s("div",me,[e[15]||(e[15]=r("strong",null,"Ausgewählt:",-1)),V(" "+m(T().join(", ")),1)])):c("",!0)]),r("div",ve,[e[17]||(e[17]=r("label",{for:"image",class:"form-label"},"Neues Bild hochladen",-1)),r("input",{type:"file",id:"image",class:"form-control",onChange:$,accept:"image/*"},null,32)]),r("div",fe,[r("button",{type:"submit",class:b(["btn btn-primary",{"btn-disabled":!F.value}]),disabled:!F.value}," Speichern ",10,ge),a.value.isDeleted?c("",!0):(o(),s("button",{key:0,type:"button",onClick:e[7]||(e[7]=t=>I(a.value.id)),class:"btn btn-danger"}," Entfernen "))])],32)]))]))}},we=j(be,[["__scopeId","data-v-b7bbba4e"]]);export{we as default};
