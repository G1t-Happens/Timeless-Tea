import{_ as M,r as p,x as U,k as P,l as O,c as l,a as t,f as T,e as g,F as z,m as J,t as v,p as b,o,n as $,b as V,v as D}from"./index-BQPN_HOS.js";import{B as j}from"./BackButton-CnNbgDn5.js";const A={class:"edit-category"},H={class:"back-button-wrapper"},R={key:0,class:"text-center"},W={key:1},Z={class:"table-wrapper"},q={class:"table"},G=["onDblclick"],Q=["onUpdate:modelValue","onInput","onBlur"],X={key:1},Y=["onUpdate:modelValue","onInput","onBlur"],ee={key:1},ne={class:"actions-column"},te=["onClick"],se={class:"pagination"},ie=["disabled"],ae=["disabled"],le={class:"actions"},oe=["disabled"],f=10,de={__name:"EditCategory",setup(re){const d=p([]),u=p([]),h=p({}),r=U([]),c=p(1),k=p(!0),C=async()=>{try{const{data:e}=await b.get("/api/category");d.value=e,u.value=JSON.parse(JSON.stringify(e))}catch(e){console.error("Fehler beim Laden der Kategorien:",e)}finally{k.value=!1}},E=async e=>{try{await b.delete(`/api/category/${e}`),d.value=d.value.filter(s=>s.id!==e),u.value=u.value.filter(s=>s.id!==e)}catch(s){console.error("Fehler beim Löschen der Kategorie:",s)}},F=P(()=>{const e=(c.value-1)*f;return d.value.slice(e,e+f)}),_=P(()=>Math.ceil(d.value.length/f)),N=()=>{c.value>1&&c.value--},S=()=>{c.value<_.value&&c.value++},K=e=>{h.value[e]=!0},x=e=>{h.value[e]&&(h.value[e]=!1,B(e))},y=e=>!!h.value[e],w=(e,s)=>{const n=d.value.find(i=>i.id===e);if(n){const i=u.value.find(a=>a.id===e);i&&n[s]!==i[s]&&B(e)}},B=e=>{const s=d.value.find(i=>i.id===e),n=u.value.find(i=>i.id===e);if(s&&n)if(Object.keys(n).some(a=>s[a]!==n[a])){const a=r.findIndex(m=>m.id===e);a>=0?r[a]={...s}:r.push({...s})}else{const a=r.findIndex(m=>m.id===e);a>=0&&r.splice(a,1)}},I=(e,s)=>{const n=d.value.find(a=>a.id===e),i=u.value.find(a=>a.id===e);return n&&i&&n[s]!==i[s]},L=async()=>{try{await Promise.all(r.map(e=>b.patch(`/api/category/${e.id}`,{name:e.name,type:e.type}))),r.length=0,await C()}catch(e){console.error("Fehler beim Speichern der Änderungen:",e)}};return O(C),(e,s)=>(o(),l("div",A,[t("div",H,[T(j,{class:"back-button"})]),s[2]||(s[2]=t("h2",{class:"page-title"},"Kategorien bearbeiten",-1)),s[3]||(s[3]=t("p",{class:"info-text"},[g(" Hinweis: Sie können Felder per "),t("strong",null,"Doppelklick"),g(" bearbeiten. Änderungen werden gesammelt und mit einem einzigen Klick geupdated! Änderungen werden "),t("strong",null,"Rot"),g(" markiert. ")],-1)),k.value?(o(),l("div",R,s[0]||(s[0]=[t("p",null,"Lade Kategorien...",-1)]))):(o(),l("div",W,[t("div",Z,[t("table",q,[s[1]||(s[1]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Name"),t("th",null,"Typ"),t("th",null,"Aktion")])],-1)),t("tbody",null,[(o(!0),l(z,null,J(F.value,n=>(o(),l("tr",{key:n.id,onDblclick:i=>K(n.id)},[t("td",null,v(n.id),1),t("td",{class:$({"modified-field":I(n.id,"name")})},[y(n.id)?V((o(),l("input",{key:0,"onUpdate:modelValue":i=>n.name=i,onInput:i=>w(n.id,"name"),onBlur:i=>x(n.id),class:"edit-input"},null,40,Q)),[[D,n.name]]):(o(),l("span",X,v(n.name),1))],2),t("td",{class:$({"modified-field":I(n.id,"type")})},[y(n.id)?V((o(),l("input",{key:0,"onUpdate:modelValue":i=>n.type=i,onInput:i=>w(n.id,"type"),onBlur:i=>x(n.id),class:"edit-input"},null,40,Y)),[[D,n.type]]):(o(),l("span",ee,v(n.type),1))],2),t("td",ne,[t("button",{onClick:i=>E(n.id),class:"btn delete-btn"},"Löschen",8,te)])],40,G))),128))])])]),t("div",se,[t("button",{onClick:N,disabled:c.value===1},"Zurück",8,ie),t("span",null,"Seite "+v(c.value)+" von "+v(_.value),1),t("button",{onClick:S,disabled:c.value===_.value},"Weiter",8,ae)]),t("div",le,[t("button",{onClick:L,class:"btn btn-primary",disabled:r.length===0}," Änderungen speichern ",8,oe)])]))]))}},pe=M(de,[["__scopeId","data-v-e654cd18"]]);export{pe as default};
