import{_ as H,y as G,B as re,k as M,o as d,C as Q,g as se,c as m,a as t,b as p,D as ne,n as E,v as b,t as g,d as c,w as W,T as le,q as y,p as U,u as oe,r as C,l as ie,f as de,x as ue,E as R,F as me,m as pe,A as ce,s as fe}from"./index-coL_GGQM.js";import{B as ye}from"./BackButton-CSr1JIJn.js";const be={class:"modal-container"},ve={class:"form-group"},ge={key:0,class:"payment-fields"},he={key:0,class:"error"},we={key:0,class:"error"},xe={key:0,class:"error"},ke={key:1,class:"payment-fields"},Ne={key:0,class:"error"},Ce={key:2,class:"payment-fields"},Be={key:0,class:"error"},De={class:"modal-actions"},Ae=["disabled"],Pe={__name:"PaymentModal",props:{show:{type:Boolean,default:!1},payment:{type:Object,required:!0,default:()=>({})},userId:{type:Number,required:!0}},emits:["close","save"],setup(F,{emit:Z}){const k=Z,V=F,l=G({}),s=G({creditCardNumber:"",expiryDate:"",cvc:"",iban:"",paypalEmail:""});re(()=>V.payment,i=>{Object.assign(l,i||{})},{immediate:!0});const w=M(()=>{if(!l.paymentOption)return!0;switch(l.paymentOption){case"credit card":return!l.creditCardNumber||!l.expiryDate||!l.cvc||!!s.creditCardNumber||!!s.expiryDate||!!s.cvc;case"bank transfer":return!l.iban||!!s.iban;case"paypal":return!l.paypalEmail||!!s.paypalEmail;default:return!0}}),x=M({get(){return l.expiryDate?B(l.expiryDate):""},set(i){l.expiryDate=i}});function B(i){if(!i)return"";const r=new Date(i);if(isNaN(r.getTime()))return console.warn("Ungültiges Datum:",i),"";const u=r.getFullYear(),v=String(r.getMonth()+1).padStart(2,"0"),P=String(r.getDate()).padStart(2,"0");return`${u}-${v}-${P}`}function D(){const i=(l.creditCardNumber||"").replace(/\s+/g,"");if(!i){s.creditCardNumber="";return}/^\d{13,19}$/.test(i)?s.creditCardNumber="":s.creditCardNumber="Bitte eine gültige Kreditkartennummer (13–19 Ziffern) eingeben"}function A(){const i=l.expiryDate;if(!i){s.expiryDate="";return}const r=new Date(i);if(isNaN(r.valueOf())){s.expiryDate="Ungültiges Datum";return}r<new Date?s.expiryDate="Das Ablaufdatum darf nicht in der Vergangenheit liegen":s.expiryDate=""}function S(){const i=l.cvc;if(!i){s.cvc="";return}/^\d{3,4}$/.test(i)?s.cvc="":s.cvc="Bitte einen gültigen CVC (3–4 Ziffern) eingeben"}function a(){const i=l.iban;if(!i){s.iban="";return}/^[A-Za-z0-9]{15,34}$/.test(i)?s.iban="":s.iban="Bitte eine gültige IBAN (15–34 alphanumerische Zeichen) eingeben"}function I(){const i=l.paypalEmail;if(!i){s.paypalEmail="";return}/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)?s.paypalEmail="":s.paypalEmail="Bitte eine gültige E-Mail-Adresse eingeben"}function O(){k("close")}async function T(){var i,r;try{if(s.creditCardNumber||s.expiryDate||s.cvc||s.iban||s.paypalEmail)return y.fire({title:"Bitte alle Fehler beheben",icon:"warning",confirmButtonText:"OK"});const u={...l};u.user=V.userId;let v;l.id?v=await K(l.id,u):v=await z(u),k("save",v.data),k("close"),N(),l.id?await y.fire({title:"Zahlungsmethode aktualisiert!",text:"Zahlungsmethode wurde erfolgreich aktualisiert.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0}):await y.fire({title:"Zahlungsmethode erstellt!",text:"Zahlungsmethode wurde erfolgreich erstellt.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0})}catch(u){console.error("Fehler beim Speichern der Zahlungsmethode:",u),await y.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((r=(i=u.response)==null?void 0:i.data)==null?void 0:r.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}function N(){Object.assign(l,{paymentOption:"",creditCardNumber:"",expiryDate:"",cvc:"",iban:"",paypalEmail:""}),Object.assign(s,{creditCardNumber:"",expiryDate:"",cvc:"",iban:"",paypalEmail:""})}async function z(i){var r,u;try{return await U.post("/api/payment/create",i)}catch(v){console.error("Fehler beim Erstellen der Zahlung:",v),await y.fire({title:"Fehler beim Erstellen der Zahlung!",text:((u=(r=v.response)==null?void 0:r.data)==null?void 0:u.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}async function K(i,r){var u,v;try{return await U.patch(`/api/payment/${i}`,r)}catch(P){console.error("Fehler beim Aktualisieren der Zahlung:",P),await y.fire({title:"Fehler beim Aktualisieren der Zahlung!",text:((v=(u=P.response)==null?void 0:u.data)==null?void 0:v.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}return(i,r)=>(d(),Q(le,{name:"fade-modal"},{default:se(()=>[F.show?(d(),m("div",{key:0,class:"modal-backdrop",onClick:W(O,["self"])},[t("div",be,[r[13]||(r[13]=t("h2",null,"Zahlungsmethode festlegen/bearbeiten",-1)),t("div",ve,[r[7]||(r[7]=t("label",{for:"paymentOption"},"Zahlungsoption",-1)),p(t("select",{id:"paymentOption","onUpdate:modelValue":r[0]||(r[0]=u=>l.paymentOption=u),class:"form-control"},r[6]||(r[6]=[t("option",{value:"credit card"},"Kreditkarte",-1),t("option",{value:"bank transfer"},"Banküberweisung",-1),t("option",{value:"paypal"},"PayPal",-1)]),512),[[ne,l.paymentOption]])]),l.paymentOption==="credit card"?(d(),m("div",ge,[t("div",{class:E(["form-group",{"has-error":s.creditCardNumber}])},[r[8]||(r[8]=t("label",{for:"creditCardNumber"},"Kartennummer",-1)),p(t("input",{id:"creditCardNumber",type:"text",class:"form-control","onUpdate:modelValue":r[1]||(r[1]=u=>l.creditCardNumber=u),placeholder:"z.B. 1234567890123456",onInput:D},null,544),[[b,l.creditCardNumber]]),s.creditCardNumber?(d(),m("span",he,g(s.creditCardNumber),1)):c("",!0)],2),t("div",{class:E(["form-group",{"has-error":s.expiryDate}])},[r[9]||(r[9]=t("label",{for:"expiryDate"},"Ablaufdatum",-1)),p(t("input",{id:"expiryDate",type:"date",class:"form-control","onUpdate:modelValue":r[2]||(r[2]=u=>x.value=u),placeholder:"YYYY-MM-DD",onBlur:A},null,544),[[b,x.value]]),s.expiryDate?(d(),m("span",we,g(s.expiryDate),1)):c("",!0)],2),t("div",{class:E(["form-group",{"has-error":s.cvc}])},[r[10]||(r[10]=t("label",{for:"cvc"},"CVC",-1)),p(t("input",{id:"cvc",type:"text",class:"form-control","onUpdate:modelValue":r[3]||(r[3]=u=>l.cvc=u),placeholder:"z.B. 123",onInput:S},null,544),[[b,l.cvc]]),s.cvc?(d(),m("span",xe,g(s.cvc),1)):c("",!0)],2)])):l.paymentOption==="bank transfer"?(d(),m("div",ke,[t("div",{class:E(["form-group",{"has-error":s.iban}])},[r[11]||(r[11]=t("label",{for:"iban"},"IBAN",-1)),p(t("input",{id:"iban",type:"text",class:"form-control","onUpdate:modelValue":r[4]||(r[4]=u=>l.iban=u),placeholder:"z.B. DE89370400440532013000",onInput:a},null,544),[[b,l.iban]]),s.iban?(d(),m("span",Ne,g(s.iban),1)):c("",!0)],2)])):l.paymentOption==="paypal"?(d(),m("div",Ce,[t("div",{class:E(["form-group",{"has-error":s.paypalEmail}])},[r[12]||(r[12]=t("label",{for:"paypalEmail"},"PayPal E-Mail",-1)),p(t("input",{id:"paypalEmail",type:"email",class:"form-control","onUpdate:modelValue":r[5]||(r[5]=u=>l.paypalEmail=u),placeholder:"z.B. user@mail.com",onInput:I},null,544),[[b,l.paypalEmail]]),s.paypalEmail?(d(),m("span",Be,g(s.paypalEmail),1)):c("",!0)],2)])):c("",!0),t("div",De,[t("button",{class:"btn btn-primary",onClick:T,disabled:w.value}," Übernehmen ",8,Ae),t("button",{class:"btn btn-danger",onClick:O},"Abbrechen")])])])):c("",!0)]),_:1}))}},Ee=H(Pe,[["__scopeId","data-v-8c646b74"]]),Oe={class:"edit-user"},$e={key:0,class:"text-center"},Ue={key:1},Se={key:0,class:"form-group"},Me={id:"userId",class:"form-control static-field"},Ve={key:1,class:"form-group"},Fe={key:2,class:"form-group"},Ze={key:3,class:"form-group"},Ie={key:4,class:"form-group toggle-switch"},Te={class:"switch","aria-labelledby":"isAdmin"},ze={class:"form-group password-fields"},Ke={class:"password-input-group"},qe=["type"],Je={class:"password-input-group"},Le=["type"],Ye={key:0,class:"error-text"},je={key:5,class:"form-group address-fields"},Ge={class:"form-group"},Re={key:0},He={key:0},Qe={key:1},We={key:2},Xe=["onClick"],_e=["onClick"],et={key:1},tt={class:"button-group"},at=["disabled"],rt={key:2,class:"text-center"},st={__name:"EditUser",setup(F){const Z=oe(),k=M(()=>Z.user),V=ce(),l=fe(),s=C(!0),w=C(""),x=C(""),B=C(!1),D=C(!1),A=C(null),S=C(null),a=C({id:null,emailAddress:"",firstName:"",lastName:"",isAdmin:!1,address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payments:[]}),I=M(()=>{const o=JSON.stringify(a.value.address)!==JSON.stringify(S.value.address),e=JSON.stringify(a.value)!==JSON.stringify(S.value),f=w.value!==""&&x.value!==""&&w.value===x.value;return(e||o||f)&&!O.value}),O=M(()=>w.value&&x.value&&w.value!==x.value),T=o=>{if(!o)return"";const e=new Date(o);if(isNaN(e.getTime()))return console.warn("Ungültiges Datum:",o),"";const f=e.getFullYear(),h=String(e.getMonth()+1).padStart(2,"0"),$=String(e.getDate()).padStart(2,"0");return`${f}-${h}-${$}`},N=o=>{B.value=o};ie(async()=>{const o=V.params.id||k.value.id;await z(o)});const z=async o=>{s.value=!0;try{const{data:e}=await U.get(`/api/user/${o}`);a.value={...a.value,...e,address:{...a.value.address,...e.address},payments:e.payments||[]},S.value=JSON.parse(JSON.stringify(a.value))}catch(e){console.error("Fehler beim Laden des Benutzers:",e),await y.fire({title:"Benutzer konnte nicht geladen werden.",icon:"error",confirmButtonText:"OK"})}finally{s.value=!1}},K=async o=>{if((await y.fire({title:"User löschen?",text:"Möchten Sie diesen User wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await U.delete(`/api/user/${o}`),await y.fire({title:"Gelöscht",text:"Der User wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}),await l.push({name:"AdminDashboard"})}catch(f){console.error("Fehler beim Löschen des Users:",f),await y.fire({title:"Fehler beim Löschen des Users.",icon:"error",confirmButtonText:"OK"})}},i=async()=>{if(O.value){await y.fire({title:"Passwörter stimmen nicht überein.",icon:"error",confirmButtonText:"OK"});return}const o={emailAddress:a.value.emailAddress,firstName:a.value.firstName,lastName:a.value.lastName,isAdmin:a.value.isAdmin,address:a.value.address,password:w.value||void 0};try{await U.patch(`/api/user/${a.value.id}`,o),await y.fire({title:"Benutzerdaten erfolgreich aktualisiert!",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),l.go()}catch(e){console.error("Fehler beim Speichern des Benutzers:",e),await y.fire({title:"Fehler beim Speichern der Benutzerdaten.",icon:"error",confirmButtonText:"OK"})}},r=o=>{A.value={...o},D.value=!0},u=async o=>{(await y.fire({title:"Zahlungsmethode löschen?",text:"Möchten Sie diese Zahlungsmethode wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed&&(await U.delete(`/api/payment/${o}`),a.value.payments=a.value.payments.filter(f=>f.id!==o),await y.fire({title:"Gelöscht",text:"Die Zahlungsmethode wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}))},v=()=>{A.value={paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""},D.value=!0},P=()=>{D.value=!1},X=async o=>{var e,f;try{if(A.value.id){const h=a.value.payments.findIndex($=>$.id===A.value.id);h!==-1&&(a.value.payments[h]=o)}else a.value.payments.push(o);P()}catch(h){console.error("Fehler beim Speichern der Zahlungsmethode:",h),await y.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((f=(e=h.response)==null?void 0:e.data)==null?void 0:f.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},_=o=>o?"**** **** **** "+o.slice(-4):"n/a",ee=o=>{if(!o)return"n/a";const e=o.replace(/\s/g,"");return e.length<=6?e:e.slice(0,4)+" **** **** "+e.slice(-2)},te=o=>{if(!o)return"n/a";const[e,f]=o.split("@");return f?e[0]+"****@"+f:o};return(o,e)=>{var f,h,$,q,J,L,Y,j;return d(),m("div",Oe,[de(ye),e[41]||(e[41]=t("h2",{class:"page-title form-label"},"Benutzer bearbeiten",-1)),s.value||!a.value?(d(),m("div",$e,e[19]||(e[19]=[t("p",null,"Lade Benutzer...",-1)]))):k.value?(d(),m("div",Ue,[t("form",{onSubmit:W(i,["prevent"]),class:"form-container",autocomplete:"off"},[(f=a.value)!=null&&f.id?(d(),m("div",Se,[e[20]||(e[20]=t("label",{for:"userId",class:"form-label"},"User ID",-1)),t("div",Me,g(a.value.id),1)])):c("",!0),(h=a.value)!=null&&h.emailAddress?(d(),m("div",Ve,[e[21]||(e[21]=t("label",{for:"email",class:"form-label"},"E-Mail-Adresse*",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.emailAddress=n),type:"email",id:"email",class:"form-control",maxlength:"100",required:""},null,512),[[b,a.value.emailAddress]])])):c("",!0),($=a.value)!=null&&$.firstName?(d(),m("div",Fe,[e[22]||(e[22]=t("label",{for:"firstName",class:"form-label"},"Vorname*",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.firstName=n),type:"text",id:"firstName",class:"form-control",maxlength:"50",required:""},null,512),[[b,a.value.firstName]])])):c("",!0),(q=a.value)!=null&&q.lastName?(d(),m("div",Ze,[e[23]||(e[23]=t("label",{for:"lastName",class:"form-label"},"Nachname*",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.lastName=n),type:"text",id:"lastName",class:"form-control",maxlength:"50",required:""},null,512),[[b,a.value.lastName]])])):c("",!0),(J=k.value)!=null&&J.isAdmin?(d(),m("div",Ie,[e[25]||(e[25]=t("label",{class:"form-label",for:"isAdmin"},"Admin",-1)),t("label",Te,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.isAdmin=n),type:"checkbox",id:"isAdmin",required:""},null,512),[[ue,a.value.isAdmin]]),e[24]||(e[24]=t("span",{class:"slider round"},null,-1))])])):c("",!0),e[37]||(e[37]=t("h3",{class:"form-label"},"Passwort ändern",-1)),t("div",ze,[e[26]||(e[26]=t("input",{type:"text",style:{display:"none"},autocomplete:"username"},null,-1)),e[27]||(e[27]=t("label",{for:"newPassword",class:"form-label"},"Neues Passwort",-1)),t("div",Ke,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),type:B.value?"text":"password",id:"newPassword",class:"form-control",placeholder:"Neues Passwort",autocomplete:"off"},null,8,qe),[[R,w.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[5]||(e[5]=n=>N(!0)),onMouseup:e[6]||(e[6]=n=>N(!1)),onMouseleave:e[7]||(e[7]=n=>N(!1))},[t("i",{class:E(B.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),e[28]||(e[28]=t("label",{for:"confirmPassword",class:"form-label"},"Passwort bestätigen",-1)),t("div",Je,[p(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>x.value=n),type:B.value?"text":"password",id:"confirmPassword",class:"form-control",placeholder:"Passwort bestätigen",autocomplete:"off"},null,8,Le),[[R,x.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[9]||(e[9]=n=>N(!0)),onMouseup:e[10]||(e[10]=n=>N(!1)),onMouseleave:e[11]||(e[11]=n=>N(!1))},[t("i",{class:E(B.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),O.value?(d(),m("p",Ye,"Die Passwörter stimmen nicht überein.")):c("",!0)]),e[38]||(e[38]=t("h3",{class:"mt-4 form-label"},"Adressenangabe",-1)),(L=a.value)!=null&&L.address?(d(),m("div",je,[e[29]||(e[29]=t("label",{for:"street",class:"form-label"},"Straße*",-1)),p(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>a.value.address.street=n),type:"text",id:"street",class:"form-control",maxlength:"30",required:""},null,512),[[b,a.value.address.street]]),e[30]||(e[30]=t("label",{for:"houseNumber",class:"form-label"},"Hausnummer*",-1)),p(t("input",{"onUpdate:modelValue":e[13]||(e[13]=n=>a.value.address.houseNumber=n),type:"text",id:"houseNumber",class:"form-control",maxlength:"8",required:""},null,512),[[b,a.value.address.houseNumber]]),e[31]||(e[31]=t("label",{for:"addressAddition",class:"form-label"},"Adresszusatz",-1)),p(t("input",{"onUpdate:modelValue":e[14]||(e[14]=n=>a.value.address.addressAddition=n),type:"text",id:"addressAddition",class:"form-control",maxlength:"150"},null,512),[[b,a.value.address.addressAddition]]),e[32]||(e[32]=t("label",{for:"city",class:"form-label"},"Stadt*",-1)),p(t("input",{"onUpdate:modelValue":e[15]||(e[15]=n=>a.value.address.city=n),type:"text",id:"city",class:"form-control",maxlength:"50",required:""},null,512),[[b,a.value.address.city]]),e[33]||(e[33]=t("label",{for:"postalCode",class:"form-label"},"Postleitzahl*",-1)),p(t("input",{"onUpdate:modelValue":e[16]||(e[16]=n=>a.value.address.postalCode=n),type:"text",id:"postalCode",class:"form-control",maxlength:"10",required:""},null,512),[[b,a.value.address.postalCode]]),e[34]||(e[34]=t("label",{for:"country",class:"form-label"},"Land*",-1)),p(t("input",{"onUpdate:modelValue":e[17]||(e[17]=n=>a.value.address.country=n),type:"text",id:"country",class:"form-control",maxlength:"60",required:""},null,512),[[b,a.value.address.country]])])):c("",!0),t("div",Ge,[e[36]||(e[36]=t("h3",{class:"form-label"},"Zahlungsmethoden",-1)),a.value.payments.length>0?(d(),m("div",Re,[(d(!0),m(me,null,pe(a.value.payments,n=>(d(),m("div",{key:n.id,class:"payment-summary"},[t("strong",null,g(n.paymentOption),1),n.paymentOption==="bank transfer"?(d(),m("div",He,[t("p",null,"IBAN: "+g(ee(n.iban)),1)])):n.paymentOption==="credit card"?(d(),m("div",Qe,[t("p",null,"Nummer: "+g(_(n.creditCardNumber)),1),t("p",null,"Ablaufdatum: "+g(T(n.expiryDate)||"n/a"),1)])):n.paymentOption==="paypal"?(d(),m("div",We,[t("p",null,"E-Mail: "+g(te(n.paypalEmail)),1)])):c("",!0),t("button",{type:"button",onClick:ae=>r(n),class:"btn btn-edit-payment"}," Bearbeiten ",8,Xe),t("button",{type:"button",onClick:ae=>u(n.id),class:"btn btn-delete-payment"}," Löschen ",8,_e)]))),128))])):(d(),m("div",et,e[35]||(e[35]=[t("p",null,"Keine Zahlungsmethoden hinterlegt.",-1)]))),t("button",{type:"button",class:"btn btn-secondary",onClick:v}," Zahlungsmethode hinzufügen ")]),e[39]||(e[39]=t("hr",{class:"section-divider"},null,-1)),t("div",tt,[t("button",{type:"submit",class:"save-btn btn",style:{"background-color":"#4a5043",color:"white"},disabled:!I.value}," Speichern ",8,at),(Y=k.value)!=null&&Y.isAdmin&&((j=a.value)!=null&&j.id)?(d(),m("button",{key:0,type:"button",onClick:e[18]||(e[18]=n=>K(a.value.id)),class:"btn btn-danger"}," Löschen ")):c("",!0)])],32),D.value?(d(),Q(Ee,{key:0,show:D.value,payment:A.value,userId:a.value.id,onClose:P,onSave:X},null,8,["show","payment","userId"])):c("",!0)])):(d(),m("div",rt,e[40]||(e[40]=[t("p",null,"Fehler: Benutzerinformationen konnten nicht geladen werden.",-1)])))])}}},ot=H(st,[["__scopeId","data-v-cb7783e8"]]);export{ot as default};
