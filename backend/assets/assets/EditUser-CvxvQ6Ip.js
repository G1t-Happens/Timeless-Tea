import{_ as D,y as Y,B as H,k as O,o,C as E,g as Q,c as d,a as t,b as i,D as W,v as m,d as B,w as F,T as X,q as u,p as N,u as _,r as v,l as ee,f as te,t as C,x as se,E as V,n as S,F as ae,m as re,A as ne,s as le}from"./index-DH_gYooc.js";import{B as oe}from"./BackButton-CpGm2r89.js";const ie={class:"modal-container"},de={class:"form-group"},ue={key:0,class:"payment-fields"},me={class:"form-group"},pe={class:"form-group"},ce={class:"form-group"},fe={key:1,class:"payment-fields"},be={class:"form-group"},ye={key:2,class:"payment-fields"},ve={class:"form-group"},ge={class:"modal-actions"},he=["disabled"],we={__name:"PaymentModal",props:{show:{type:Boolean,default:!1},payment:{type:Object,required:!0,default:()=>({})},userId:{type:Number,required:!0}},emits:["close","save"],setup(U,{emit:$}){const g=$,r=Y({}),P=U;H(()=>P.payment,p=>{Object.assign(r,p||{})},{immediate:!0});const A=O(()=>{if(!r.paymentOption)return!0;switch(r.paymentOption){case"credit card":return!r.creditCardNumber||!r.expiryDate||!r.cvc;case"bank transfer":return!r.iban;case"paypal":return!r.paypalEmail;default:return!0}}),f=()=>{g("close")},y=async()=>{var p,s;try{const l={...r};l.user=P.userId;let c;r.id?c=await x(r.id,l):c=await w(l),g("save",c.data),g("close"),h(),r.id?await u.fire({title:"Zahlungsmethode updated!",text:"Zahlungsmethode wurde erfolgreich geupdated.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0}):await u.fire({title:"Zahlungsmethode erstellt!",text:"Zahlungsmethode wurde erfolgreich erstellt.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0})}catch(l){console.error("Fehler beim Speichern der Zahlungsmethode:",l),await u.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((s=(p=l.response)==null?void 0:p.data)==null?void 0:s.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},h=()=>{Object.assign(r,{paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""})};async function w(p){var s,l;try{return await N.post("/api/payment/create",p)}catch(c){console.error("Fehler beim Erstellen der Zahlung:",c),await u.fire({title:"Fehler beim Erstellen der Zahlung!",text:((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}async function x(p,s){var l,c;try{return await N.patch(`/api/payment/${p}`,s)}catch(b){console.error("Fehler beim Aktualisieren der Zahlung:",b),await u.fire({title:"Fehler beim Aktualisieren der Zahlung!",text:((c=(l=b.response)==null?void 0:l.data)==null?void 0:c.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}}return(p,s)=>(o(),E(X,{name:"fade-modal"},{default:Q(()=>[U.show?(o(),d("div",{key:0,class:"modal-backdrop",onClick:F(f,["self"])},[t("div",ie,[s[13]||(s[13]=t("h2",null,"Zahlungsmethode festlegen/bearbeiten",-1)),t("div",de,[s[7]||(s[7]=t("label",{for:"paymentOption"},"Zahlungsoption",-1)),i(t("select",{id:"paymentOption","onUpdate:modelValue":s[0]||(s[0]=l=>r.paymentOption=l),class:"form-control"},s[6]||(s[6]=[t("option",{value:"credit card"},"Kreditkarte",-1),t("option",{value:"bank transfer"},"Banküberweisung",-1),t("option",{value:"paypal"},"PayPal",-1)]),512),[[W,r.paymentOption]])]),r.paymentOption==="credit card"?(o(),d("div",ue,[t("div",me,[s[8]||(s[8]=t("label",{for:"creditCardNumber"},"Kartennummer",-1)),i(t("input",{id:"creditCardNumber",type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=l=>r.creditCardNumber=l),placeholder:"z.B. 1234 5678 9012 3456"},null,512),[[m,r.creditCardNumber]])]),t("div",pe,[s[9]||(s[9]=t("label",{for:"expiryDate"},"Ablaufdatum",-1)),i(t("input",{id:"expiryDate",type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=l=>r.expiryDate=l),placeholder:"MM/YY"},null,512),[[m,r.expiryDate]])]),t("div",ce,[s[10]||(s[10]=t("label",{for:"cvc"},"CVC",-1)),i(t("input",{id:"cvc",type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=l=>r.cvc=l),placeholder:"z.B. 123"},null,512),[[m,r.cvc]])])])):r.paymentOption==="bank transfer"?(o(),d("div",fe,[t("div",be,[s[11]||(s[11]=t("label",{for:"iban"},"IBAN",-1)),i(t("input",{id:"iban",type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>r.iban=l),placeholder:"z.B. DE89370400440532013000"},null,512),[[m,r.iban]])])])):r.paymentOption==="paypal"?(o(),d("div",ye,[t("div",ve,[s[12]||(s[12]=t("label",{for:"paypalEmail"},"PayPal E-Mail",-1)),i(t("input",{id:"paypalEmail",type:"email",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=l=>r.paypalEmail=l),placeholder:"z.B. user@mail.com"},null,512),[[m,r.paypalEmail]])])])):B("",!0),t("div",ge,[t("button",{class:"btn btn-primary",onClick:y,disabled:A.value}," Übernehmen ",8,he),t("button",{class:"btn btn-danger",onClick:f},"Abbrechen")])])])):B("",!0)]),_:1}))}},xe=D(we,[["__scopeId","data-v-a50357ed"]]),ke={class:"edit-user"},Be={key:0,class:"text-center"},Ce={key:1},Ne={class:"form-group"},Pe={id:"userId",class:"form-control static-field"},Ae={class:"form-group"},Oe={class:"form-group"},Ue={class:"form-group"},$e={key:0,class:"form-group toggle-switch"},Me={class:"switch","aria-labelledby":"isAdmin"},Ve={class:"form-group password-fields"},Se={class:"password-input-group"},De=["type"],Ee={class:"password-input-group"},Fe=["type"],Ze={key:0,class:"error-text"},Te={class:"form-group address-fields"},ze={class:"form-group"},Ie={key:0},Ke={key:0},Je={key:1},Le={key:2},qe=["onClick"],je=["onClick"],Ge={key:1},Re={class:"button-group"},Ye=["disabled"],He={__name:"EditUser",setup(U){const $=_(),g=O(()=>$.user),r=ne(),P=le(),A=v(!0),f=v(""),y=v(""),h=v(!1),w=v(!1),x=v(null),p=v(null),s=v({id:null,emailAddress:"",firstName:"",lastName:"",isAdmin:!1,address:{id:null,street:"",houseNumber:"",addressAddition:"",city:"",postalCode:"",country:""},payments:[]}),l=O(()=>{const n=JSON.stringify(s.value.address)!==JSON.stringify(p.value.address),e=JSON.stringify(s.value)!==JSON.stringify(p.value),a=f.value!==""&&y.value!==""&&f.value===y.value;return(e||n||a)&&!c.value}),c=O(()=>f.value&&y.value&&f.value!==y.value),b=n=>{h.value=n};ee(async()=>{const n=r.params.id||g.value.id;await Z(n)});const Z=async n=>{A.value=!0;try{const{data:e}=await N.get(`/api/user/${n}`);s.value={...s.value,...e,address:{...s.value.address,...e.address},payments:e.payments||[]},p.value=JSON.parse(JSON.stringify(s.value))}catch(e){console.error("Fehler beim Laden des Benutzers:",e),await u.fire({title:"Benutzer konnte nicht geladen werden.",icon:"error",confirmButtonText:"OK"})}finally{A.value=!1}},T=async n=>{if((await u.fire({title:"User löschen?",text:"Möchten Sie diesen User wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed)try{await N.delete(`/api/user/${n}`),await u.fire({title:"Gelöscht",text:"Der User wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}),await P.push({name:"AdminDasboard"})}catch(a){console.error("Fehler beim Löschen des Users:",a),await u.fire({title:"Fehler beim Löschen des Users.",icon:"error",confirmButtonText:"OK"})}},z=async()=>{if(c.value){await u.fire({title:"Passwörter stimmen nicht überein.",icon:"error",confirmButtonText:"OK"});return}const n={emailAddress:s.value.emailAddress,firstName:s.value.firstName,lastName:s.value.lastName,isAdmin:s.value.isAdmin,address:s.value.address,password:f.value||void 0};try{await N.patch(`/api/user/${s.value.id}`,n),await u.fire({title:"Benutzerdaten erfolgreich aktualisiert!",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),P.go()}catch(e){console.error("Fehler beim Speichern des Benutzers:",e),await u.fire({title:"Fehler beim Speichern der Benutzerdaten.",icon:"error",confirmButtonText:"OK"})}},I=n=>{x.value={...n},w.value=!0},K=async n=>{(await u.fire({title:"Zahlungsmethode löschen?",text:"Möchten Sie diese Zahlungsmethode wirklich löschen? Dieser Vorgang kann nicht rückgängig gemacht werden.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ja, löschen",cancelButtonText:"Abbrechen"})).isConfirmed&&(await N.delete(`/api/payment/${n}`),s.value.payments=s.value.payments.filter(a=>a.id!==n),await u.fire({title:"Gelöscht",text:"Die Zahlungsmethode wurde erfolgreich gelöscht.",icon:"success",confirmButtonText:"OK"}))},J=()=>{x.value={paymentOption:"",creditCardNumber:"",iban:"",paypalEmail:"",expiryDate:""},w.value=!0},M=()=>{w.value=!1},L=async n=>{var e,a;try{if(x.value.id){const k=s.value.payments.findIndex(R=>R.id===x.value.id);k!==-1&&(s.value.payments[k]=n)}else s.value.payments.push(n);M()}catch(k){console.error("Fehler beim Speichern der Zahlungsmethode:",k),await u.fire({title:"Fehler beim Speichern der Zahlungsmethode!",text:((a=(e=k.response)==null?void 0:e.data)==null?void 0:a.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}},q=n=>n?"**** **** **** "+n.slice(-4):"n/a",j=n=>{if(!n)return"n/a";const e=n.replace(/\s/g,"");return e.length<=6?e:e.slice(0,4)+" **** **** "+e.slice(-2)},G=n=>{if(!n)return"n/a";const[e,a]=n.split("@");return a?e[0]+"****@"+a:n};return(n,e)=>(o(),d("div",ke,[te(oe),e[40]||(e[40]=t("h2",{class:"page-title form-label"},"Benutzer bearbeiten",-1)),A.value||!s.value?(o(),d("div",Be,e[19]||(e[19]=[t("p",null,"Lade Benutzer...",-1)]))):(o(),d("div",Ce,[t("form",{onSubmit:F(z,["prevent"]),class:"form-container",autocomplete:"off"},[t("div",Ne,[e[20]||(e[20]=t("label",{for:"userId",class:"form-label"},"User ID",-1)),t("div",Pe,C(s.value.id),1)]),t("div",Ae,[e[21]||(e[21]=t("label",{for:"email",class:"form-label"},"E-Mail-Adresse",-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.emailAddress=a),type:"email",id:"email",class:"form-control",required:""},null,512),[[m,s.value.emailAddress]])]),t("div",Oe,[e[22]||(e[22]=t("label",{for:"firstName",class:"form-label"},"Vorname",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.firstName=a),type:"text",id:"firstName",class:"form-control",required:""},null,512),[[m,s.value.firstName]])]),t("div",Ue,[e[23]||(e[23]=t("label",{for:"lastName",class:"form-label"},"Nachname",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.lastName=a),type:"text",id:"lastName",class:"form-control",required:""},null,512),[[m,s.value.lastName]])]),g.value.isAdmin?(o(),d("div",$e,[e[25]||(e[25]=t("label",{class:"form-label",for:"isAdmin"},"Admin",-1)),t("label",Me,[i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.isAdmin=a),type:"checkbox",id:"isAdmin"},null,512),[[se,s.value.isAdmin]]),e[24]||(e[24]=t("span",{class:"slider round"},null,-1))])])):B("",!0),e[37]||(e[37]=t("h3",{class:"form-label"},"Passwort ändern",-1)),t("div",Ve,[e[26]||(e[26]=t("input",{type:"text",style:{display:"none"},autocomplete:"username"},null,-1)),e[27]||(e[27]=t("label",{for:"newPassword",class:"form-label"},"Neues Passwort",-1)),t("div",Se,[i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),type:h.value?"text":"password",id:"newPassword",class:"form-control",placeholder:"Neues Passwort",autocomplete:"off"},null,8,De),[[V,f.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[5]||(e[5]=a=>b(!0)),onMouseup:e[6]||(e[6]=a=>b(!1)),onMouseleave:e[7]||(e[7]=a=>b(!1))},[t("i",{class:S(h.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),e[28]||(e[28]=t("label",{for:"confirmPassword",class:"form-label"},"Passwort bestätigen",-1)),t("div",Ee,[i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),type:h.value?"text":"password",id:"confirmPassword",class:"form-control",placeholder:"Passwort bestätigen",autocomplete:"off"},null,8,Fe),[[V,y.value]]),t("button",{type:"button",class:"btn btn-show-password",onMousedown:e[9]||(e[9]=a=>b(!0)),onMouseup:e[10]||(e[10]=a=>b(!1)),onMouseleave:e[11]||(e[11]=a=>b(!1))},[t("i",{class:S(h.value?"bi bi-eye-slash":"bi bi-eye")},null,2)],32)]),c.value?(o(),d("p",Ze,"Die Passwörter stimmen nicht überein.")):B("",!0)]),e[38]||(e[38]=t("h3",{class:"mt-4 form-label"},"Adressenangabe",-1)),t("div",Te,[e[29]||(e[29]=t("label",{for:"street",class:"form-label"},"Straße*",-1)),i(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.address.street=a),type:"text",id:"street",class:"form-control"},null,512),[[m,s.value.address.street]]),e[30]||(e[30]=t("label",{for:"houseNumber",class:"form-label"},"Hausnummer*",-1)),i(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.address.houseNumber=a),type:"text",id:"houseNumber",class:"form-control"},null,512),[[m,s.value.address.houseNumber]]),e[31]||(e[31]=t("label",{for:"addressAddition",class:"form-label"},"Adresszusatz",-1)),i(t("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.address.addressAddition=a),type:"text",id:"addressAddition",class:"form-control"},null,512),[[m,s.value.address.addressAddition]]),e[32]||(e[32]=t("label",{for:"city",class:"form-label"},"Stadt*",-1)),i(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.address.city=a),type:"text",id:"city",class:"form-control"},null,512),[[m,s.value.address.city]]),e[33]||(e[33]=t("label",{for:"postalCode",class:"form-label"},"Postleitzahl*",-1)),i(t("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.address.postalCode=a),type:"text",id:"postalCode",class:"form-control"},null,512),[[m,s.value.address.postalCode]]),e[34]||(e[34]=t("label",{for:"country",class:"form-label"},"Land*",-1)),i(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>s.value.address.country=a),type:"text",id:"country",class:"form-control"},null,512),[[m,s.value.address.country]])]),t("div",ze,[e[36]||(e[36]=t("h3",{class:"form-label"},"Zahlungsmethoden",-1)),s.value.payments.length>0?(o(),d("div",Ie,[(o(!0),d(ae,null,re(s.value.payments,a=>(o(),d("div",{key:a.id,class:"payment-summary"},[t("strong",null,C(a.paymentOption),1),a.paymentOption==="bank transfer"?(o(),d("div",Ke,[t("p",null,"IBAN: "+C(j(a.iban)),1)])):a.paymentOption==="credit card"?(o(),d("div",Je,[t("p",null,"Nummer: "+C(q(a.creditCardNumber)),1),t("p",null,"Ablaufdatum: "+C(a.expiryDate||"n/a"),1)])):a.paymentOption==="paypal"?(o(),d("div",Le,[t("p",null,"E-Mail: "+C(G(a.paypalEmail)),1)])):B("",!0),t("button",{type:"button",onClick:k=>I(a),class:"btn btn-edit-payment"}," Bearbeiten ",8,qe),t("button",{type:"button",onClick:k=>K(a.id),class:"btn btn-delete-payment"}," Löschen ",8,je)]))),128))])):(o(),d("div",Ge,e[35]||(e[35]=[t("p",null,"Keine Zahlungsmethoden hinterlegt.",-1)]))),t("button",{type:"button",class:"btn btn-secondary",onClick:J}," Zahlungsmethode hinzufügen ")]),e[39]||(e[39]=t("hr",{class:"section-divider"},null,-1)),t("div",Re,[t("button",{type:"submit",class:"btn save-btn",disabled:!l.value},"Speichern",8,Ye),g.value.isAdmin?(o(),d("button",{key:0,type:"button",onClick:e[18]||(e[18]=a=>T(s.value.id)),class:"btn btn-danger"}," Löschen ")):B("",!0)])],32)])),w.value?(o(),E(xe,{key:2,show:w.value,payment:x.value,userId:s.value.id,onClose:M,onSave:L},null,8,["show","payment","userId"])):B("",!0)]))}},Xe=D(He,[["__scopeId","data-v-6e34178b"]]);export{Xe as default};
