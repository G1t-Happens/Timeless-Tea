import{_ as S,r as o,l as K,p as D,k as L,c as i,f as O,a as r,d as c,n as g,b,v as h,t as d,F as A,m as N,e as C,w as j,o as s,x as Z,s as $,q as F}from"./index-coL_GGQM.js";import{B as G}from"./BackButton-CSr1JIJn.js";const Q={class:"create-article"},J={key:0,class:"image-preview"},H=["src"],W={key:0,class:"error"},X={key:0,class:"error"},Y={key:0,class:"error"},ee={key:0,class:"error"},te={class:"form-group"},ae={key:0,class:"dropdown-menu"},ne=["value"],re={key:1,class:"selected-options"},le={class:"form-group"},ie=["disabled"],se={__name:"CreateArticle",setup(oe){const u=o(""),y=o(""),p=o(""),m=o(""),v=o([]),k=o([]),w=o(null),x=o(null),B=o(null),V=$(),a=o({name:"",description:"",price:"",quantity:""}),_=t=>{const e=t.reduce((n,l)=>{const f=l.type||"Andere";return n[f]=n[f]||[],n[f].push(l),n},{});return Object.entries(e).map(([n,l])=>({type:n,categories:l}))};K(async()=>{try{const t=await D.get("/api/category");k.value=_(t.data)}catch(t){console.error("Fehler beim Laden der Kategorien:",t)}});const z=t=>{w.value=w.value===t?null:t},M=()=>v.value.map(t=>{var e;return(e=k.value.flatMap(n=>n.categories).find(n=>n.id===t))==null?void 0:e.name}),P=t=>{const e=t.target.files;e&&e[0]&&(x.value=e[0],B.value=URL.createObjectURL(e[0]))};function U(){u.value.trim()?u.value.trim().length>30?a.value.name="Der Name darf max. 30 Zeichen lang sein":a.value.name="":a.value.name="Bitte einen Artikelnamen eingeben"}function E(){y.value.trim().length>512?a.value.description="Die Beschreibung darf max. 512 Zeichen lang sein.":a.value.description=""}function I(){const t=p.value;if(!t){a.value.price="Bitte einen Preis eingeben.";return}if(!/^\d+(\.\d{1,2})?$/.test(t)){a.value.price="Preis darf max. zwei Nachkommastellen haben.";return}const n=parseFloat(t);if(n<0||n>1e3){a.value.price="Preis muss zwischen 0 und 1000 liegen.";return}a.value.price=""}function T(){const t=m.value;if(t==null||t===""){a.value.quantity="Bitte eine Menge eingeben";return}if(isNaN(t)){a.value.quantity="Bitte eine gültige Menge eingeben";return}if(!Number.isInteger(t)){a.value.quantity="Bitte nur ganze Zahlen eingeben";return}if(t<0){a.value.quantity="Die Menge darf nicht negativ sein";return}if(t>1e5){a.value.quantity="Die Menge darf nicht mehr als 100000 sein";return}a.value.quantity=""}const q=L(()=>{const t=!!u.value.trim(),e=!!p.value,n=!!m.value;return!(a.value.name||a.value.description||a.value.price||a.value.quantity)&&t&&e&&n}),R=async()=>{var e,n;const t=new FormData;t.append("name",u.value),t.append("description",y.value),t.append("price",p.value),t.append("quantity",m.value),t.append("categories",JSON.stringify(v.value)),x.value instanceof File&&t.append("image",x.value);try{await D.post("/api/product",t),await F.fire({title:"Artikel erstellt!",text:`Artikel: "${u.value}" wurde erfolgreich erstellt.`,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),await V.push({name:"AdminDashboard"})}catch(l){console.error("Fehler beim Erstellen des Artikels:",l),await F.fire({title:"Fehler beim Erstellen des Artikels!",text:((n=(e=l.response)==null?void 0:e.data)==null?void 0:n.error)||"Ein unbekannter Fehler ist aufgetreten.",icon:"error",confirmButtonText:"OK"})}};return(t,e)=>(s(),i("div",Q,[O(G),e[13]||(e[13]=r("h2",{class:"page-title"},"Neuen Artikel erstellen",-1)),r("form",{onSubmit:j(R,["prevent"]),class:"form-container",method:"post",enctype:"multipart/form-data"},[B.value?(s(),i("div",J,[r("img",{src:B.value,alt:"Vorschau des hochgeladenen Bildes",class:"preview-image"},null,8,H)])):c("",!0),r("div",{class:g(["form-group",{"has-error":a.value.name}])},[e[6]||(e[6]=r("label",{for:"name",class:"form-label"},"Artikelname",-1)),b(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>u.value=n),id:"name",class:"form-control",maxlength:"30",placeholder:"z.B. Sencha Green Tea",onInput:U,required:""},null,544),[[h,u.value]]),a.value.name?(s(),i("span",W,d(a.value.name),1)):c("",!0)],2),r("div",{class:g(["form-group",{"has-error":a.value.description}])},[e[7]||(e[7]=r("label",{for:"description",class:"form-label"},"Beschreibung",-1)),b(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>y.value=n),id:"description",class:"form-control",placeholder:"z.B. Dieser Tee...",onInput:E,maxlength:"512"},null,544),[[h,y.value]]),a.value.description?(s(),i("span",X,d(a.value.description),1)):c("",!0)],2),r("div",{class:g(["form-group",{"has-error":a.value.price}])},[e[8]||(e[8]=r("label",{for:"price",class:"form-label"},"Preis in €",-1)),b(r("input",{type:"number",step:"0.01","onUpdate:modelValue":e[2]||(e[2]=n=>p.value=n),id:"price",class:"form-control",placeholder:"z.B. 12.99",onInput:I,min:"0",max:"1000",required:""},null,544),[[h,p.value]]),a.value.price?(s(),i("span",Y,d(a.value.price),1)):c("",!0)],2),r("div",{class:g(["form-group",{"has-error":a.value.quantity}])},[e[9]||(e[9]=r("label",{for:"price",class:"form-label"},"Menge in g (Gram)",-1)),b(r("input",{type:"number",step:"1","onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),id:"quantity",placeholder:"z.B. 100",class:"form-control",onInput:T,min:"1",max:"100000",required:""},null,544),[[h,m.value]]),a.value.quantity?(s(),i("span",ee,d(a.value.quantity),1)):c("",!0)],2),r("div",te,[e[11]||(e[11]=r("label",{for:"categories",class:"form-label"},"Kategorien",-1)),r("button",{class:"dropdown-button",type:"button",onClick:e[4]||(e[4]=n=>z("categories"))}," ▾ Kategorien wählen "),w.value==="categories"?(s(),i("div",ae,[(s(!0),i(A,null,N(k.value,n=>(s(),i("div",{key:n.type},[r("strong",null,d(n.type),1),(s(!0),i(A,null,N(n.categories,l=>(s(),i("div",{key:l.id},[r("label",null,[b(r("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=f=>v.value=f),value:l.id},null,8,ne),[[Z,v.value]]),C(" "+d(l.name),1)])]))),128))]))),128))])):c("",!0),v.value.length?(s(),i("div",re,[e[10]||(e[10]=r("strong",null,"Ausgewählt:",-1)),C(" "+d(M().join(", ")),1)])):c("",!0)]),r("div",le,[e[12]||(e[12]=r("label",{for:"image",class:"form-label"},"Bild hochladen",-1)),r("input",{type:"file",id:"image",class:"form-control",onChange:P,accept:"image/*"},null,32)]),r("button",{type:"submit",class:g(["btn btn-primary w-100",{"btn-disabled":!q.value}]),disabled:!q.value}," Artikel erstellen ",10,ie)],32)]))}},de=S(se,[["__scopeId","data-v-3e8042fa"]]);export{de as default};
